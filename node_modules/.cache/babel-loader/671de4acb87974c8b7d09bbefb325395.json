{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar React = tslib_1.__importStar(require(\"react\"));\n\nvar PropTypes = tslib_1.__importStar(require(\"prop-types\"));\n\nvar ArrowTriangleUpDown_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleUpDown\"));\n\nvar ArrowTriangleUp_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleUp\"));\n\nvar ArrowTriangleDown_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleDown\"));\n\nvar identifiers_1 = require(\"../../lib/events/keyboard/identifiers\");\n\nvar locale_1 = require(\"../DatePicker/locale\");\n\nvar decorators_1 = require(\"../LocaleProvider/decorators\");\n\nvar RenderLayer_1 = tslib_1.__importDefault(require(\"../RenderLayer\"));\n\nvar DropdownContainer_1 = tslib_1.__importDefault(require(\"../DropdownContainer/DropdownContainer\"));\n\nvar LayoutEvents_1 = tslib_1.__importDefault(require(\"../../lib/LayoutEvents\"));\n\nvar DateSelect_module_less_1 = tslib_1.__importDefault(require(\"./DateSelect.module.css\"));\n\nvar Emotion_1 = require(\"../../lib/theming/Emotion\");\n\nvar DateSelect_styles_1 = tslib_1.__importDefault(require(\"./DateSelect.styles\"));\n\nvar ThemeConsumer_1 = tslib_1.__importDefault(require(\"../ThemeConsumer\"));\n\nvar itemHeight = 24;\nvar visibleYearsCount = 11;\nvar itemsToMoveCount = -5;\nvar monthsCount = 12;\nvar defaultMinYear = 1900;\nvar defaultMaxYear = 2100;\n\nvar DateSelect =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(DateSelect, _super);\n\n  function DateSelect() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      botCapped: false,\n      current: 0,\n      height: 0,\n      opened: false,\n      pos: 0,\n      top: 0,\n      topCapped: false,\n      nodeTop: Infinity\n    };\n    _this.root = null;\n    _this.itemsContainer = null;\n    _this.longClickTimer = 0;\n    _this.setPositionRepeatTimer = 0;\n    _this.yearStep = 3;\n    /**\r\n                         * @public\r\n                         */\n\n    _this.open = function () {\n      if (_this.props.disabled) {\n        return;\n      }\n\n      if (_this.state.opened) {\n        return;\n      }\n\n      _this.setPosition(0);\n\n      _this.setState({\n        opened: true,\n        current: 0\n      });\n    };\n    /**\r\n        * @public\r\n        */\n\n\n    _this.close = function () {\n      if (!_this.state.opened) {\n        return;\n      }\n\n      _this.setState({\n        opened: false\n      });\n    };\n\n    _this.refRoot = function (element) {\n      _this.root = element;\n    };\n\n    _this.setNodeTop = function () {\n      var root = _this.root;\n\n      if (!root) {\n        return;\n      }\n\n      if (_this.timeout) {\n        clearTimeout(_this.timeout);\n      }\n\n      _this.timeout = setTimeout(function () {\n        return _this.setState({\n          nodeTop: root.getBoundingClientRect().top\n        });\n      });\n    };\n\n    _this.refItemsContainer = function (element) {\n      if (!_this.itemsContainer && element) {\n        element.addEventListener('wheel', _this.handleWheel, {\n          passive: false\n        });\n      }\n\n      if (_this.itemsContainer && !element) {\n        _this.itemsContainer.removeEventListener('wheel', _this.handleWheel);\n      }\n\n      _this.itemsContainer = element;\n    };\n\n    _this.handleLongClickUp = function (event) {\n      event.preventDefault();\n      _this.longClickTimer = window.setTimeout(function () {\n        _this.setPositionRepeatTimer = window.setInterval(function () {\n          return _this.setPosition(_this.state.pos - itemHeight);\n        }, 100);\n      }, 200);\n    };\n\n    _this.handleLongClickDown = function (event) {\n      event.preventDefault();\n      _this.longClickTimer = window.setTimeout(function () {\n        _this.setPositionRepeatTimer = window.setInterval(function () {\n          return _this.setPosition(_this.state.pos + itemHeight);\n        }, 100);\n      }, 200);\n    };\n\n    _this.handleLongClickStop = function () {\n      clearTimeout(_this.longClickTimer);\n      clearTimeout(_this.setPositionRepeatTimer);\n    };\n\n    _this.getAnchor = function () {\n      return _this.root;\n    };\n\n    _this.handleWheel = function (event) {\n      if (!(event instanceof WheelEvent)) {\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n      var deltaY = event.deltaY;\n\n      if (event.deltaMode === 1) {\n        deltaY *= itemHeight;\n      } else if (event.deltaMode === 2) {\n        deltaY *= itemHeight * 4;\n      }\n\n      var pos = _this.state.pos += deltaY;\n\n      _this.setPosition(pos);\n    };\n\n    _this.handleItemClick = function (shift) {\n      return function (e) {\n        var value = _this.props.value + shift;\n\n        if (_this.props.onChange) {\n          _this.props.onChange(value);\n        }\n\n        _this.setState({\n          opened: false\n        });\n      };\n    };\n\n    _this.handleKey = function (e) {\n      if (_this.state.opened && identifiers_1.isKeyEscape(e)) {\n        e.preventDefault();\n\n        _this.close();\n\n        e.stopPropagation();\n      }\n    };\n\n    _this.handleUp = function (event) {\n      event.preventDefault();\n\n      _this.setPosition(_this.state.pos - itemHeight * _this.yearStep);\n    };\n\n    _this.handleDown = function (event) {\n      event.preventDefault();\n\n      _this.setPosition(_this.state.pos + itemHeight * _this.yearStep);\n    };\n\n    return _this;\n  }\n\n  DateSelect.prototype.componentWillReceiveProps = function () {\n    this.setNodeTop();\n  };\n\n  DateSelect.prototype.componentDidMount = function () {\n    this.listener = LayoutEvents_1[\"default\"].addListener(this.setNodeTop);\n    this.setNodeTop();\n    window.addEventListener('keydown', this.handleKey);\n  };\n\n  DateSelect.prototype.componentWillUnmount = function () {\n    if (this.listener) {\n      this.listener.remove();\n    }\n\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n    }\n\n    if (this.longClickTimer) {\n      clearTimeout(this.longClickTimer);\n    }\n\n    if (this.setPositionRepeatTimer) {\n      clearTimeout(this.setPositionRepeatTimer);\n    }\n\n    window.removeEventListener('keydown', this.handleKey);\n  };\n\n  DateSelect.prototype.render = function () {\n    var _this = this;\n\n    return React.createElement(ThemeConsumer_1[\"default\"], null, function (theme) {\n      _this.theme = theme;\n      return _this.renderMain();\n    });\n  };\n\n  DateSelect.prototype.renderMain = function () {\n    var _a, _b;\n\n    var _c = this.props,\n        width = _c.width,\n        disabled = _c.disabled;\n    var rootProps = {\n      className: Emotion_1.cx((_a = {}, _a[DateSelect_module_less_1[\"default\"].root] = true, _a[DateSelect_styles_1[\"default\"].root(this.theme)] = true, _a[DateSelect_module_less_1[\"default\"].disabled] = !!disabled, _a)),\n      style: {\n        width: width\n      },\n      ref: this.refRoot\n    };\n    return React.createElement(\"span\", tslib_1.__assign({}, rootProps), React.createElement(\"div\", {\n      className: DateSelect_module_less_1[\"default\"].caption,\n      onClick: this.open\n    }, this.getItem(0), React.createElement(\"div\", {\n      className: Emotion_1.cx((_b = {}, _b[DateSelect_module_less_1[\"default\"].arrow] = true, _b[DateSelect_styles_1[\"default\"].arrow(this.theme)] = true, _b[DateSelect_module_less_1[\"default\"].arrowDisabled] = !!disabled, _b))\n    }, React.createElement(ArrowTriangleUpDown_1[\"default\"], {\n      size: 12\n    }))), this.state.opened && this.renderMenu());\n  };\n\n  DateSelect.prototype.disableItems = function (index) {\n    var value = this.props.value + index;\n\n    if (this.props.maxValue != null && this.props.minValue != null) {\n      return value > this.props.maxValue || value < this.props.minValue;\n    }\n\n    if (this.props.minValue != null) {\n      return value < this.props.minValue;\n    }\n\n    if (this.props.maxValue != null) {\n      return value > this.props.maxValue;\n    }\n  };\n\n  DateSelect.prototype.renderMenu = function () {\n    var _this = this;\n\n    var _a;\n\n    var _b = this.state,\n        top = _b.top,\n        height = _b.height,\n        nodeTop = _b.nodeTop;\n    var shift = this.state.pos % itemHeight;\n\n    if (shift < 0) {\n      shift += itemHeight;\n    }\n\n    var from = (this.state.pos - shift + top) / itemHeight;\n    var to = from + Math.ceil((height + shift) / itemHeight);\n    var items = [];\n\n    var _loop_1 = function _loop_1(i) {\n      var _a;\n\n      var disableItems = this_1.disableItems(i) || false;\n      var className = Emotion_1.cx((_a = {}, _a[DateSelect_module_less_1[\"default\"].menuItem] = true, _a[DateSelect_styles_1[\"default\"].menuItem(this_1.theme)] = true, _a[DateSelect_styles_1[\"default\"].menuItemSelected(this_1.theme)] = i === 0, _a[DateSelect_styles_1[\"default\"].menuItemActive(this_1.theme)] = i === this_1.state.current, _a[DateSelect_module_less_1[\"default\"].menuItemDisabled] = disableItems, _a[DateSelect_styles_1[\"default\"].menuItemDisabled(this_1.theme)] = disableItems, _a));\n      var clickHandler = {\n        onMouseDown: preventDefault,\n        onClick: this_1.handleItemClick(i)\n      };\n      items.push(React.createElement(\"div\", tslib_1.__assign({\n        key: i,\n        className: className,\n        // tslint:disable-next-line:jsx-no-lambda\n        onMouseEnter: function onMouseEnter() {\n          return _this.setState({\n            current: i\n          });\n        },\n        // tslint:disable-next-line:jsx-no-lambda\n        onMouseLeave: function onMouseLeave() {\n          return _this.setState({\n            current: null\n          });\n        }\n      }, clickHandler), this_1.getItem(i)));\n    };\n\n    var this_1 = this;\n\n    for (var i = from; i < to; ++i) {\n      _loop_1(i);\n    }\n\n    var style = {\n      top: top - 5,\n      left: 0,\n      right: 0\n    };\n    var shiftStyle = {\n      position: 'relative',\n      top: -shift\n    };\n    var holderClass = Emotion_1.cx((_a = {}, _a[DateSelect_module_less_1[\"default\"].menuHolder] = true, _a[DateSelect_styles_1[\"default\"].menuHolder(this.theme)] = true, _a[DateSelect_module_less_1[\"default\"].isTopCapped] = this.state.topCapped, _a[DateSelect_module_less_1[\"default\"].isBotCapped] = this.state.botCapped, _a));\n    var dropdownOffset = -itemHeight;\n\n    if (nodeTop < -top) {\n      var overflowOffsetDelta = this.state.topCapped ? 6 : 17;\n      dropdownOffset -= nodeTop + top - overflowOffsetDelta;\n    }\n\n    return React.createElement(RenderLayer_1[\"default\"], {\n      onClickOutside: this.close,\n      onFocusOutside: this.close,\n      active: true\n    }, React.createElement(\"div\", null, React.createElement(DropdownContainer_1[\"default\"], {\n      getParent: this.getAnchor,\n      offsetY: dropdownOffset,\n      offsetX: -10\n    }, React.createElement(\"div\", {\n      className: holderClass,\n      style: style\n    }, !this.state.topCapped && React.createElement(\"div\", {\n      className: Emotion_1.cx(DateSelect_module_less_1[\"default\"].menuUp, DateSelect_styles_1[\"default\"].menuUp(this.theme)),\n      onClick: this.handleUp,\n      onMouseDown: this.handleLongClickUp,\n      onMouseUp: this.handleLongClickStop,\n      onMouseLeave: this.handleLongClickStop,\n      onTouchStart: this.handleLongClickUp,\n      onTouchEnd: this.handleLongClickStop\n    }, React.createElement(\"span\", null, React.createElement(ArrowTriangleUp_1[\"default\"], null))), React.createElement(\"div\", {\n      className: DateSelect_module_less_1[\"default\"].itemsHolder,\n      style: {\n        height: height\n      }\n    }, React.createElement(\"div\", {\n      ref: this.refItemsContainer,\n      style: shiftStyle\n    }, items)), !this.state.botCapped && React.createElement(\"div\", {\n      className: Emotion_1.cx(DateSelect_module_less_1[\"default\"].menuDown, DateSelect_styles_1[\"default\"].menuDown(this.theme)),\n      onClick: this.handleDown,\n      onMouseDown: this.handleLongClickDown,\n      onMouseUp: this.handleLongClickStop,\n      onMouseLeave: this.handleLongClickStop,\n      onTouchStart: this.handleLongClickDown,\n      onTouchEnd: this.handleLongClickStop\n    }, React.createElement(\"span\", null, React.createElement(ArrowTriangleDown_1[\"default\"], null)))))));\n  };\n\n  DateSelect.prototype.getItem = function (index) {\n    var value = this.props.value + index;\n\n    if (this.props.type === 'month') {\n      return this.locale.months[value];\n    }\n\n    return value;\n  };\n\n  DateSelect.prototype.setPosition = function (pos) {\n    var top = itemsToMoveCount * itemHeight;\n    var height = visibleYearsCount * itemHeight;\n\n    if (this.props.type === 'month') {\n      top = -this.props.value * itemHeight;\n      height = monthsCount * itemHeight;\n    }\n\n    var minPos = this.getMinPos() - top;\n    var maxPos = this.getMaxPos() - top - height + itemHeight;\n\n    if (minPos >= pos) {\n      pos = minPos;\n    }\n\n    if (maxPos <= pos) {\n      pos = maxPos;\n    }\n\n    var topCapped = pos <= minPos;\n    var botCapped = pos >= maxPos;\n    this.setState({\n      pos: pos,\n      top: top,\n      height: height,\n      topCapped: topCapped,\n      botCapped: botCapped\n    });\n  };\n\n  DateSelect.prototype.getMinPos = function () {\n    if (this.props.type === 'month') {\n      return -this.props.value * itemHeight;\n    } else if (this.props.type === 'year') {\n      return ((this.props.minValue || defaultMinYear) - this.props.value) * itemHeight;\n    }\n\n    return -Infinity; // Be defensive.\n  };\n\n  DateSelect.prototype.getMaxPos = function () {\n    if (this.props.type === 'month') {\n      return (visibleYearsCount - this.props.value) * itemHeight;\n    } else if (this.props.type === 'year') {\n      return ((this.props.maxValue || defaultMaxYear) - this.props.value) * itemHeight;\n    }\n\n    return Infinity; // Be defensive.\n  };\n\n  DateSelect.__KONTUR_REACT_UI__ = 'DateSelect';\n  DateSelect.propTypes = {\n    disabled: PropTypes.bool,\n    type: PropTypes.string,\n    value: PropTypes.number.isRequired,\n    width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    onChange: PropTypes.func,\n    minValue: PropTypes.number,\n    maxValue: PropTypes.number\n  };\n  DateSelect.defaultProps = {\n    type: 'year',\n    minMonth: 0,\n    maxMonth: 11,\n    width: 'auto'\n  };\n  DateSelect = tslib_1.__decorate([decorators_1.locale('DatePicker', locale_1.DatePickerLocaleHelper)], DateSelect);\n  return DateSelect;\n}(React.Component);\n\nexports[\"default\"] = DateSelect;\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}","map":{"version":3,"sources":["C:/Users/Sasha/Documents/coursework.front/node_modules/@skbkontur/react-ui/components/DateSelect/DateSelect.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","React","__importStar","PropTypes","ArrowTriangleUpDown_1","__importDefault","ArrowTriangleUp_1","ArrowTriangleDown_1","identifiers_1","locale_1","decorators_1","RenderLayer_1","DropdownContainer_1","LayoutEvents_1","DateSelect_module_less_1","Emotion_1","DateSelect_styles_1","ThemeConsumer_1","itemHeight","visibleYearsCount","itemsToMoveCount","monthsCount","defaultMinYear","defaultMaxYear","DateSelect","_super","__extends","_this","apply","arguments","state","botCapped","current","height","opened","pos","top","topCapped","nodeTop","Infinity","root","itemsContainer","longClickTimer","setPositionRepeatTimer","yearStep","open","props","disabled","setPosition","setState","close","refRoot","element","setNodeTop","timeout","clearTimeout","setTimeout","getBoundingClientRect","refItemsContainer","addEventListener","handleWheel","passive","removeEventListener","handleLongClickUp","event","preventDefault","window","setInterval","handleLongClickDown","handleLongClickStop","getAnchor","WheelEvent","stopPropagation","deltaY","deltaMode","handleItemClick","shift","e","onChange","handleKey","isKeyEscape","handleUp","handleDown","prototype","componentWillReceiveProps","componentDidMount","listener","addListener","componentWillUnmount","remove","render","createElement","theme","renderMain","_a","_b","_c","width","rootProps","className","cx","style","ref","__assign","caption","onClick","getItem","arrow","arrowDisabled","size","renderMenu","disableItems","index","maxValue","minValue","from","to","Math","ceil","items","_loop_1","i","this_1","menuItem","menuItemSelected","menuItemActive","menuItemDisabled","clickHandler","onMouseDown","push","key","onMouseEnter","onMouseLeave","left","right","shiftStyle","position","holderClass","menuHolder","isTopCapped","isBotCapped","dropdownOffset","overflowOffsetDelta","onClickOutside","onFocusOutside","active","getParent","offsetY","offsetX","menuUp","onMouseUp","onTouchStart","onTouchEnd","itemsHolder","menuDown","type","locale","months","minPos","getMinPos","maxPos","getMaxPos","__KONTUR_REACT_UI__","propTypes","bool","string","number","isRequired","oneOfType","func","defaultProps","minMonth","maxMonth","__decorate","DatePickerLocaleHelper","Component"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar React = tslib_1.__importStar(require(\"react\"));\nvar PropTypes = tslib_1.__importStar(require(\"prop-types\"));\nvar ArrowTriangleUpDown_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleUpDown\"));\nvar ArrowTriangleUp_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleUp\"));\nvar ArrowTriangleDown_1 = tslib_1.__importDefault(require(\"@skbkontur/react-icons/ArrowTriangleDown\"));\nvar identifiers_1 = require(\"../../lib/events/keyboard/identifiers\");\nvar locale_1 = require(\"../DatePicker/locale\");\nvar decorators_1 = require(\"../LocaleProvider/decorators\");\nvar RenderLayer_1 = tslib_1.__importDefault(require(\"../RenderLayer\"));\nvar DropdownContainer_1 = tslib_1.__importDefault(require(\"../DropdownContainer/DropdownContainer\"));\nvar LayoutEvents_1 = tslib_1.__importDefault(require(\"../../lib/LayoutEvents\"));\nvar DateSelect_module_less_1 = tslib_1.__importDefault(require(\"./DateSelect.module.css\"));\nvar Emotion_1 = require(\"../../lib/theming/Emotion\");\nvar DateSelect_styles_1 = tslib_1.__importDefault(require(\"./DateSelect.styles\"));\nvar ThemeConsumer_1 = tslib_1.__importDefault(require(\"../ThemeConsumer\"));\nvar itemHeight = 24;\nvar visibleYearsCount = 11;\nvar itemsToMoveCount = -5;\nvar monthsCount = 12;\nvar defaultMinYear = 1900;\nvar defaultMaxYear = 2100;\nvar DateSelect = /** @class */function (_super) {\n  tslib_1.__extends(DateSelect, _super);\n  function DateSelect() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.state = {\n      botCapped: false,\n      current: 0,\n      height: 0,\n      opened: false,\n      pos: 0,\n      top: 0,\n      topCapped: false,\n      nodeTop: Infinity };\n\n    _this.root = null;\n    _this.itemsContainer = null;\n    _this.longClickTimer = 0;\n    _this.setPositionRepeatTimer = 0;\n    _this.yearStep = 3;\n    /**\r\n                         * @public\r\n                         */\n    _this.open = function () {\n      if (_this.props.disabled) {\n        return;\n      }\n      if (_this.state.opened) {\n        return;\n      }\n      _this.setPosition(0);\n      _this.setState({\n        opened: true,\n        current: 0 });\n\n    };\n    /**\r\n        * @public\r\n        */\n    _this.close = function () {\n      if (!_this.state.opened) {\n        return;\n      }\n      _this.setState({ opened: false });\n    };\n    _this.refRoot = function (element) {\n      _this.root = element;\n    };\n    _this.setNodeTop = function () {\n      var root = _this.root;\n      if (!root) {\n        return;\n      }\n      if (_this.timeout) {\n        clearTimeout(_this.timeout);\n      }\n      _this.timeout = setTimeout(function () {\n        return _this.setState({\n          nodeTop: root.getBoundingClientRect().top });\n\n      });\n    };\n    _this.refItemsContainer = function (element) {\n      if (!_this.itemsContainer && element) {\n        element.addEventListener('wheel', _this.handleWheel, { passive: false });\n      }\n      if (_this.itemsContainer && !element) {\n        _this.itemsContainer.removeEventListener('wheel', _this.handleWheel);\n      }\n      _this.itemsContainer = element;\n    };\n    _this.handleLongClickUp = function (event) {\n      event.preventDefault();\n      _this.longClickTimer = window.setTimeout(function () {\n        _this.setPositionRepeatTimer = window.setInterval(function () {return _this.setPosition(_this.state.pos - itemHeight);}, 100);\n      }, 200);\n    };\n    _this.handleLongClickDown = function (event) {\n      event.preventDefault();\n      _this.longClickTimer = window.setTimeout(function () {\n        _this.setPositionRepeatTimer = window.setInterval(function () {return _this.setPosition(_this.state.pos + itemHeight);}, 100);\n      }, 200);\n    };\n    _this.handleLongClickStop = function () {\n      clearTimeout(_this.longClickTimer);\n      clearTimeout(_this.setPositionRepeatTimer);\n    };\n    _this.getAnchor = function () {return _this.root;};\n    _this.handleWheel = function (event) {\n      if (!(event instanceof WheelEvent)) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      var deltaY = event.deltaY;\n      if (event.deltaMode === 1) {\n        deltaY *= itemHeight;\n      } else\n      if (event.deltaMode === 2) {\n        deltaY *= itemHeight * 4;\n      }\n      var pos = _this.state.pos += deltaY;\n      _this.setPosition(pos);\n    };\n    _this.handleItemClick = function (shift) {\n      return function (e) {\n        var value = _this.props.value + shift;\n        if (_this.props.onChange) {\n          _this.props.onChange(value);\n        }\n        _this.setState({ opened: false });\n      };\n    };\n    _this.handleKey = function (e) {\n      if (_this.state.opened && identifiers_1.isKeyEscape(e)) {\n        e.preventDefault();\n        _this.close();\n        e.stopPropagation();\n      }\n    };\n    _this.handleUp = function (event) {\n      event.preventDefault();\n      _this.setPosition(_this.state.pos - itemHeight * _this.yearStep);\n    };\n    _this.handleDown = function (event) {\n      event.preventDefault();\n      _this.setPosition(_this.state.pos + itemHeight * _this.yearStep);\n    };\n    return _this;\n  }\n  DateSelect.prototype.componentWillReceiveProps = function () {\n    this.setNodeTop();\n  };\n  DateSelect.prototype.componentDidMount = function () {\n    this.listener = LayoutEvents_1[\"default\"].addListener(this.setNodeTop);\n    this.setNodeTop();\n    window.addEventListener('keydown', this.handleKey);\n  };\n  DateSelect.prototype.componentWillUnmount = function () {\n    if (this.listener) {\n      this.listener.remove();\n    }\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n    }\n    if (this.longClickTimer) {\n      clearTimeout(this.longClickTimer);\n    }\n    if (this.setPositionRepeatTimer) {\n      clearTimeout(this.setPositionRepeatTimer);\n    }\n    window.removeEventListener('keydown', this.handleKey);\n  };\n  DateSelect.prototype.render = function () {\n    var _this = this;\n    return React.createElement(ThemeConsumer_1[\"default\"], null, function (theme) {\n      _this.theme = theme;\n      return _this.renderMain();\n    });\n  };\n  DateSelect.prototype.renderMain = function () {\n    var _a, _b;\n    var _c = this.props,width = _c.width,disabled = _c.disabled;\n    var rootProps = {\n      className: Emotion_1.cx((_a = {},\n      _a[DateSelect_module_less_1[\"default\"].root] = true,\n      _a[DateSelect_styles_1[\"default\"].root(this.theme)] = true,\n      _a[DateSelect_module_less_1[\"default\"].disabled] = !!disabled,\n      _a)),\n      style: { width: width },\n      ref: this.refRoot };\n\n    return React.createElement(\"span\", tslib_1.__assign({}, rootProps),\n    React.createElement(\"div\", { className: DateSelect_module_less_1[\"default\"].caption, onClick: this.open },\n    this.getItem(0),\n    React.createElement(\"div\", { className: Emotion_1.cx((_b = {},\n      _b[DateSelect_module_less_1[\"default\"].arrow] = true,\n      _b[DateSelect_styles_1[\"default\"].arrow(this.theme)] = true,\n      _b[DateSelect_module_less_1[\"default\"].arrowDisabled] = !!disabled,\n      _b)) },\n    React.createElement(ArrowTriangleUpDown_1[\"default\"], { size: 12 }))),\n    this.state.opened && this.renderMenu());\n  };\n  DateSelect.prototype.disableItems = function (index) {\n    var value = this.props.value + index;\n    if (this.props.maxValue != null && this.props.minValue != null) {\n      return value > this.props.maxValue || value < this.props.minValue;\n    }\n    if (this.props.minValue != null) {\n      return value < this.props.minValue;\n    }\n    if (this.props.maxValue != null) {\n      return value > this.props.maxValue;\n    }\n  };\n  DateSelect.prototype.renderMenu = function () {\n    var _this = this;\n    var _a;\n    var _b = this.state,top = _b.top,height = _b.height,nodeTop = _b.nodeTop;\n    var shift = this.state.pos % itemHeight;\n    if (shift < 0) {\n      shift += itemHeight;\n    }\n    var from = (this.state.pos - shift + top) / itemHeight;\n    var to = from + Math.ceil((height + shift) / itemHeight);\n    var items = [];\n    var _loop_1 = function _loop_1(i) {\n      var _a;\n      var disableItems = this_1.disableItems(i) || false;\n      var className = Emotion_1.cx((_a = {},\n      _a[DateSelect_module_less_1[\"default\"].menuItem] = true,\n      _a[DateSelect_styles_1[\"default\"].menuItem(this_1.theme)] = true,\n      _a[DateSelect_styles_1[\"default\"].menuItemSelected(this_1.theme)] = i === 0,\n      _a[DateSelect_styles_1[\"default\"].menuItemActive(this_1.theme)] = i === this_1.state.current,\n      _a[DateSelect_module_less_1[\"default\"].menuItemDisabled] = disableItems,\n      _a[DateSelect_styles_1[\"default\"].menuItemDisabled(this_1.theme)] = disableItems,\n      _a));\n      var clickHandler = {\n        onMouseDown: preventDefault,\n        onClick: this_1.handleItemClick(i) };\n\n      items.push(React.createElement(\"div\", tslib_1.__assign({ key: i, className: className,\n        // tslint:disable-next-line:jsx-no-lambda\n        onMouseEnter: function onMouseEnter() {return _this.setState({ current: i });},\n        // tslint:disable-next-line:jsx-no-lambda\n        onMouseLeave: function onMouseLeave() {return _this.setState({ current: null });} }, clickHandler), this_1.getItem(i)));\n    };\n    var this_1 = this;\n    for (var i = from; i < to; ++i) {\n      _loop_1(i);\n    }\n    var style = {\n      top: top - 5,\n      left: 0,\n      right: 0 };\n\n    var shiftStyle = {\n      position: 'relative',\n      top: -shift };\n\n    var holderClass = Emotion_1.cx((_a = {},\n    _a[DateSelect_module_less_1[\"default\"].menuHolder] = true,\n    _a[DateSelect_styles_1[\"default\"].menuHolder(this.theme)] = true,\n    _a[DateSelect_module_less_1[\"default\"].isTopCapped] = this.state.topCapped,\n    _a[DateSelect_module_less_1[\"default\"].isBotCapped] = this.state.botCapped,\n    _a));\n    var dropdownOffset = -itemHeight;\n    if (nodeTop < -top) {\n      var overflowOffsetDelta = this.state.topCapped ? 6 : 17;\n      dropdownOffset -= nodeTop + top - overflowOffsetDelta;\n    }\n    return React.createElement(RenderLayer_1[\"default\"], { onClickOutside: this.close, onFocusOutside: this.close, active: true },\n    React.createElement(\"div\", null,\n    React.createElement(DropdownContainer_1[\"default\"], { getParent: this.getAnchor, offsetY: dropdownOffset, offsetX: -10 },\n    React.createElement(\"div\", { className: holderClass, style: style },\n    !this.state.topCapped && React.createElement(\"div\", { className: Emotion_1.cx(DateSelect_module_less_1[\"default\"].menuUp, DateSelect_styles_1[\"default\"].menuUp(this.theme)), onClick: this.handleUp, onMouseDown: this.handleLongClickUp, onMouseUp: this.handleLongClickStop, onMouseLeave: this.handleLongClickStop, onTouchStart: this.handleLongClickUp, onTouchEnd: this.handleLongClickStop },\n    React.createElement(\"span\", null,\n    React.createElement(ArrowTriangleUp_1[\"default\"], null))),\n    React.createElement(\"div\", { className: DateSelect_module_less_1[\"default\"].itemsHolder, style: { height: height } },\n    React.createElement(\"div\", { ref: this.refItemsContainer, style: shiftStyle }, items)),\n    !this.state.botCapped && React.createElement(\"div\", { className: Emotion_1.cx(DateSelect_module_less_1[\"default\"].menuDown, DateSelect_styles_1[\"default\"].menuDown(this.theme)), onClick: this.handleDown, onMouseDown: this.handleLongClickDown, onMouseUp: this.handleLongClickStop, onMouseLeave: this.handleLongClickStop, onTouchStart: this.handleLongClickDown, onTouchEnd: this.handleLongClickStop },\n    React.createElement(\"span\", null,\n    React.createElement(ArrowTriangleDown_1[\"default\"], null)))))));\n  };\n  DateSelect.prototype.getItem = function (index) {\n    var value = this.props.value + index;\n    if (this.props.type === 'month') {\n      return this.locale.months[value];\n    }\n    return value;\n  };\n  DateSelect.prototype.setPosition = function (pos) {\n    var top = itemsToMoveCount * itemHeight;\n    var height = visibleYearsCount * itemHeight;\n    if (this.props.type === 'month') {\n      top = -this.props.value * itemHeight;\n      height = monthsCount * itemHeight;\n    }\n    var minPos = this.getMinPos() - top;\n    var maxPos = this.getMaxPos() - top - height + itemHeight;\n    if (minPos >= pos) {\n      pos = minPos;\n    }\n    if (maxPos <= pos) {\n      pos = maxPos;\n    }\n    var topCapped = pos <= minPos;\n    var botCapped = pos >= maxPos;\n    this.setState({ pos: pos, top: top, height: height, topCapped: topCapped, botCapped: botCapped });\n  };\n  DateSelect.prototype.getMinPos = function () {\n    if (this.props.type === 'month') {\n      return -this.props.value * itemHeight;\n    } else\n    if (this.props.type === 'year') {\n      return ((this.props.minValue || defaultMinYear) - this.props.value) * itemHeight;\n    }\n    return -Infinity; // Be defensive.\n  };\n  DateSelect.prototype.getMaxPos = function () {\n    if (this.props.type === 'month') {\n      return (visibleYearsCount - this.props.value) * itemHeight;\n    } else\n    if (this.props.type === 'year') {\n      return ((this.props.maxValue || defaultMaxYear) - this.props.value) * itemHeight;\n    }\n    return Infinity; // Be defensive.\n  };\n  DateSelect.__KONTUR_REACT_UI__ = 'DateSelect';\n  DateSelect.propTypes = {\n    disabled: PropTypes.bool,\n    type: PropTypes.string,\n    value: PropTypes.number.isRequired,\n    width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    onChange: PropTypes.func,\n    minValue: PropTypes.number,\n    maxValue: PropTypes.number };\n\n  DateSelect.defaultProps = {\n    type: 'year',\n    minMonth: 0,\n    maxMonth: 11,\n    width: 'auto' };\n\n  DateSelect = tslib_1.__decorate([\n  decorators_1.locale('DatePicker', locale_1.DatePickerLocaleHelper)],\n  DateSelect);\n  return DateSelect;\n}(React.Component);\nexports[\"default\"] = DateSelect;\nfunction preventDefault(e) {\n  e.preventDefault();\n}"]},"metadata":{},"sourceType":"script"}