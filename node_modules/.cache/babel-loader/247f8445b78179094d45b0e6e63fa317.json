{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar React = tslib_1.__importStar(require(\"react\"));\n\nvar identifiers_1 = require(\"../../../lib/events/keyboard/identifiers\");\n\nvar InternalMenu_1 = tslib_1.__importDefault(require(\"../InternalMenu/InternalMenu\"));\n\nvar Popup_1 = tslib_1.__importDefault(require(\"../../Popup\"));\n\nvar RenderLayer_1 = tslib_1.__importDefault(require(\"../../RenderLayer\"));\n\nvar PopupMenuPositions_1 = tslib_1.__importDefault(require(\"./PopupMenuPositions\"));\n\nvar validatePositions_1 = tslib_1.__importDefault(require(\"./validatePositions\"));\n\nvar PopupMenu_module_less_1 = tslib_1.__importDefault(require(\"./PopupMenu.module.css\"));\n\nexports.PopupMenuType = {\n  Dropdown: 'dropdown',\n  Tooltip: 'tooltip'\n};\n\nvar PopupMenu =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(PopupMenu, _super);\n\n  function PopupMenu() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      menuVisible: false,\n      firstItemShouldBeSelected: false\n    };\n    _this.captionWrapper = null;\n    _this.savedFocusableElement = null;\n    _this.menu = null;\n\n    _this.open = function () {\n      return _this.showMenu();\n    };\n\n    _this.close = function () {\n      return _this.hideMenu();\n    };\n\n    _this.refInternalMenu = function (element) {\n      return _this.menu = element;\n    };\n\n    _this.handleOpen = function () {\n      if (_this.menu) {\n        _this.menu.focus();\n      }\n    };\n\n    _this.renderCaption = function () {\n      if (typeof _this.props.caption === 'function') {\n        var caption = _this.props.caption({\n          opened: _this.state.menuVisible,\n          openMenu: _this.showMenu,\n          closeMenu: _this.hideMenu,\n          toggleMenu: _this.toggleMenu\n        });\n\n        return React.createElement(\"span\", {\n          className: PopupMenu_module_less_1[\"default\"].caption,\n          ref: function ref(element) {\n            return _this.captionWrapper = element;\n          }\n        }, caption);\n      }\n\n      return React.createElement(\"span\", {\n        onClick: _this.handleCaptionClick,\n        onKeyDown: _this.handleCaptionKeyDown,\n        ref: function ref(element) {\n          return _this.captionWrapper = element;\n        },\n        className: PopupMenu_module_less_1[\"default\"].caption\n      }, _this.props.caption);\n    };\n\n    _this.hideMenuWithoutFocusing = function () {\n      return _this.hideMenu();\n    };\n\n    _this.showMenu = function (firstItemShouldBeSelected) {\n      _this.saveFocus();\n\n      _this.setState({\n        menuVisible: true,\n        firstItemShouldBeSelected: firstItemShouldBeSelected\n      }, function () {\n        _this.handleChangeMenuVisible(false);\n      });\n    };\n\n    _this.hideMenu = function (restoreFocus) {\n      _this.setState({\n        menuVisible: false,\n        firstItemShouldBeSelected: false\n      }, function () {\n        _this.handleChangeMenuVisible(!!restoreFocus);\n      });\n    };\n\n    _this.toggleMenu = function () {\n      _this.state.menuVisible ? _this.hideMenu() : _this.showMenu();\n    };\n\n    _this.handleCaptionClick = function () {\n      _this.toggleMenu();\n    };\n\n    _this.handleCaptionKeyDown = function (e) {\n      if (identifiers_1.someKeys(identifiers_1.isKeyEnter, identifiers_1.isKeySpace, identifiers_1.isKeyArrowVertical)(e)) {\n        e.preventDefault();\n\n        _this.showMenu(true);\n      }\n    };\n\n    _this.handleKeyDown = function (e) {\n      if (identifiers_1.isKeyEscape(e)) {\n        var restoreFocus = true;\n\n        _this.hideMenu(restoreFocus);\n      }\n    };\n\n    _this.saveFocus = function () {\n      if (document) {\n        _this.savedFocusableElement = document.activeElement;\n      }\n    };\n\n    _this.restoreFocus = function () {\n      if (_this.savedFocusableElement) {\n        _this.savedFocusableElement.focus();\n\n        _this.savedFocusableElement = null;\n      }\n    };\n\n    _this.handleChangeMenuVisible = function (focusShouldBeRestored) {\n      if (focusShouldBeRestored) {\n        _this.restoreFocus();\n      }\n\n      if (typeof _this.props.onChangeMenuState === 'function') {\n        _this.props.onChangeMenuState(_this.state.menuVisible, focusShouldBeRestored);\n      }\n    };\n\n    _this.handleItemSelection = function (event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n\n      if (event.type === 'keydown') {\n        event.preventDefault();\n      }\n\n      var restoreFocus = event.type === 'keydown';\n\n      _this.hideMenu(restoreFocus);\n    };\n\n    return _this;\n  }\n\n  PopupMenu.prototype.render = function () {\n    return React.createElement(RenderLayer_1[\"default\"], {\n      onClickOutside: this.hideMenuWithoutFocusing,\n      onFocusOutside: this.hideMenuWithoutFocusing,\n      active: this.state.menuVisible\n    }, React.createElement(\"div\", {\n      className: PopupMenu_module_less_1[\"default\"].container\n    }, this.renderCaption(), this.captionWrapper && this.props.children && React.createElement(Popup_1[\"default\"], {\n      anchorElement: this.captionWrapper,\n      opened: this.state.menuVisible,\n      hasShadow: true,\n      margin: this.props.popupMargin,\n      hasPin: this.props.popupHasPin,\n      pinOffset: this.props.popupPinOffset,\n      positions: this.getPositions(),\n      disableAnimations: this.props.disableAnimations,\n      onOpen: this.handleOpen\n    }, React.createElement(InternalMenu_1[\"default\"], {\n      hasShadow: false,\n      maxHeight: this.props.menuMaxHeight || 'none',\n      onKeyDown: this.handleKeyDown,\n      width: this.props.menuWidth || 'auto',\n      onItemClick: this.handleItemSelection,\n      cyclicSelection: false,\n      ref: this.refInternalMenu,\n      initialSelectedItemIndex: this.state.firstItemShouldBeSelected ? 0 : -1,\n      header: this.props.header,\n      footer: this.props.footer\n    }, this.props.children))));\n  };\n\n  PopupMenu.prototype.getPositions = function () {\n    if (this.props.positions && validatePositions_1[\"default\"](this.props.positions)) {\n      return this.props.positions;\n    }\n\n    return PopupMenuPositions_1[\"default\"];\n  };\n\n  PopupMenu.__KONTUR_REACT_UI__ = 'PopupMenu';\n  PopupMenu.defaultProps = {\n    positions: PopupMenuPositions_1[\"default\"],\n    type: exports.PopupMenuType.Tooltip,\n    popupHasPin: true,\n    popupMargin: 0,\n    disableAnimations: false\n  };\n  PopupMenu.Type = exports.PopupMenuType;\n  return PopupMenu;\n}(React.Component);\n\nexports[\"default\"] = PopupMenu;","map":{"version":3,"sources":["/home/aleksandr/coursework.front/node_modules/@skbkontur/react-ui/components/internal/PopupMenu/PopupMenu.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","React","__importStar","identifiers_1","InternalMenu_1","__importDefault","Popup_1","RenderLayer_1","PopupMenuPositions_1","validatePositions_1","PopupMenu_module_less_1","PopupMenuType","Dropdown","Tooltip","PopupMenu","_super","__extends","_this","apply","arguments","state","menuVisible","firstItemShouldBeSelected","captionWrapper","savedFocusableElement","menu","open","showMenu","close","hideMenu","refInternalMenu","element","handleOpen","focus","renderCaption","props","caption","opened","openMenu","closeMenu","toggleMenu","createElement","className","ref","onClick","handleCaptionClick","onKeyDown","handleCaptionKeyDown","hideMenuWithoutFocusing","saveFocus","setState","handleChangeMenuVisible","restoreFocus","e","someKeys","isKeyEnter","isKeySpace","isKeyArrowVertical","preventDefault","handleKeyDown","isKeyEscape","document","activeElement","focusShouldBeRestored","onChangeMenuState","handleItemSelection","event","isDefaultPrevented","type","prototype","render","onClickOutside","onFocusOutside","active","container","children","anchorElement","hasShadow","margin","popupMargin","hasPin","popupHasPin","pinOffset","popupPinOffset","positions","getPositions","disableAnimations","onOpen","maxHeight","menuMaxHeight","width","menuWidth","onItemClick","cyclicSelection","initialSelectedItemIndex","header","footer","__KONTUR_REACT_UI__","defaultProps","Type","Component"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar React = tslib_1.__importStar(require(\"react\"));\nvar identifiers_1 = require(\"../../../lib/events/keyboard/identifiers\");\nvar InternalMenu_1 = tslib_1.__importDefault(require(\"../InternalMenu/InternalMenu\"));\nvar Popup_1 = tslib_1.__importDefault(require(\"../../Popup\"));\nvar RenderLayer_1 = tslib_1.__importDefault(require(\"../../RenderLayer\"));\nvar PopupMenuPositions_1 = tslib_1.__importDefault(require(\"./PopupMenuPositions\"));\nvar validatePositions_1 = tslib_1.__importDefault(require(\"./validatePositions\"));\nvar PopupMenu_module_less_1 = tslib_1.__importDefault(require(\"./PopupMenu.module.css\"));\nexports.PopupMenuType = {\n  Dropdown: 'dropdown',\n  Tooltip: 'tooltip' };\n\nvar PopupMenu = /** @class */function (_super) {\n  tslib_1.__extends(PopupMenu, _super);\n  function PopupMenu() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.state = {\n      menuVisible: false,\n      firstItemShouldBeSelected: false };\n\n    _this.captionWrapper = null;\n    _this.savedFocusableElement = null;\n    _this.menu = null;\n    _this.open = function () {return _this.showMenu();};\n    _this.close = function () {return _this.hideMenu();};\n    _this.refInternalMenu = function (element) {return _this.menu = element;};\n    _this.handleOpen = function () {\n      if (_this.menu) {\n        _this.menu.focus();\n      }\n    };\n    _this.renderCaption = function () {\n      if (typeof _this.props.caption === 'function') {\n        var caption = _this.props.caption({\n          opened: _this.state.menuVisible,\n          openMenu: _this.showMenu,\n          closeMenu: _this.hideMenu,\n          toggleMenu: _this.toggleMenu });\n\n        return React.createElement(\"span\", { className: PopupMenu_module_less_1[\"default\"].caption, ref: function ref(element) {return _this.captionWrapper = element;} }, caption);\n      }\n      return React.createElement(\"span\", { onClick: _this.handleCaptionClick, onKeyDown: _this.handleCaptionKeyDown, ref: function ref(element) {return _this.captionWrapper = element;}, className: PopupMenu_module_less_1[\"default\"].caption }, _this.props.caption);\n    };\n    _this.hideMenuWithoutFocusing = function () {return _this.hideMenu();};\n    _this.showMenu = function (firstItemShouldBeSelected) {\n      _this.saveFocus();\n      _this.setState({\n        menuVisible: true,\n        firstItemShouldBeSelected: firstItemShouldBeSelected },\n      function () {\n        _this.handleChangeMenuVisible(false);\n      });\n    };\n    _this.hideMenu = function (restoreFocus) {\n      _this.setState({\n        menuVisible: false,\n        firstItemShouldBeSelected: false },\n      function () {\n        _this.handleChangeMenuVisible(!!restoreFocus);\n      });\n    };\n    _this.toggleMenu = function () {\n      _this.state.menuVisible ? _this.hideMenu() : _this.showMenu();\n    };\n    _this.handleCaptionClick = function () {\n      _this.toggleMenu();\n    };\n    _this.handleCaptionKeyDown = function (e) {\n      if (identifiers_1.someKeys(identifiers_1.isKeyEnter, identifiers_1.isKeySpace, identifiers_1.isKeyArrowVertical)(e)) {\n        e.preventDefault();\n        _this.showMenu(true);\n      }\n    };\n    _this.handleKeyDown = function (e) {\n      if (identifiers_1.isKeyEscape(e)) {\n        var restoreFocus = true;\n        _this.hideMenu(restoreFocus);\n      }\n    };\n    _this.saveFocus = function () {\n      if (document) {\n        _this.savedFocusableElement = document.activeElement;\n      }\n    };\n    _this.restoreFocus = function () {\n      if (_this.savedFocusableElement) {\n        _this.savedFocusableElement.focus();\n        _this.savedFocusableElement = null;\n      }\n    };\n    _this.handleChangeMenuVisible = function (focusShouldBeRestored) {\n      if (focusShouldBeRestored) {\n        _this.restoreFocus();\n      }\n      if (typeof _this.props.onChangeMenuState === 'function') {\n        _this.props.onChangeMenuState(_this.state.menuVisible, focusShouldBeRestored);\n      }\n    };\n    _this.handleItemSelection = function (event) {\n      if (event.isDefaultPrevented()) {\n        return;\n      }\n      if (event.type === 'keydown') {\n        event.preventDefault();\n      }\n      var restoreFocus = event.type === 'keydown';\n      _this.hideMenu(restoreFocus);\n    };\n    return _this;\n  }\n  PopupMenu.prototype.render = function () {\n    return React.createElement(RenderLayer_1[\"default\"], { onClickOutside: this.hideMenuWithoutFocusing, onFocusOutside: this.hideMenuWithoutFocusing, active: this.state.menuVisible },\n    React.createElement(\"div\", { className: PopupMenu_module_less_1[\"default\"].container },\n    this.renderCaption(),\n    this.captionWrapper &&\n    this.props.children && React.createElement(Popup_1[\"default\"], { anchorElement: this.captionWrapper, opened: this.state.menuVisible, hasShadow: true, margin: this.props.popupMargin, hasPin: this.props.popupHasPin, pinOffset: this.props.popupPinOffset, positions: this.getPositions(), disableAnimations: this.props.disableAnimations, onOpen: this.handleOpen },\n    React.createElement(InternalMenu_1[\"default\"], { hasShadow: false, maxHeight: this.props.menuMaxHeight || 'none', onKeyDown: this.handleKeyDown, width: this.props.menuWidth || 'auto', onItemClick: this.handleItemSelection, cyclicSelection: false, ref: this.refInternalMenu, initialSelectedItemIndex: this.state.firstItemShouldBeSelected ? 0 : -1, header: this.props.header, footer: this.props.footer }, this.props.children))));\n  };\n  PopupMenu.prototype.getPositions = function () {\n    if (this.props.positions && validatePositions_1[\"default\"](this.props.positions)) {\n      return this.props.positions;\n    }\n    return PopupMenuPositions_1[\"default\"];\n  };\n  PopupMenu.__KONTUR_REACT_UI__ = 'PopupMenu';\n  PopupMenu.defaultProps = {\n    positions: PopupMenuPositions_1[\"default\"],\n    type: exports.PopupMenuType.Tooltip,\n    popupHasPin: true,\n    popupMargin: 0,\n    disableAnimations: false };\n\n  PopupMenu.Type = exports.PopupMenuType;\n  return PopupMenu;\n}(React.Component);\nexports[\"default\"] = PopupMenu;"]},"metadata":{},"sourceType":"script"}