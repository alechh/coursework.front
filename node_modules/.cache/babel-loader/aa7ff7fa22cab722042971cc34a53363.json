{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar React = tslib_1.__importStar(require(\"react\"));\n\nvar normalize_wheel_1 = tslib_1.__importDefault(require(\"normalize-wheel\"));\n\nvar constants_1 = require(\"../../lib/date/constants\");\n\nvar config_1 = tslib_1.__importDefault(require(\"./config\"));\n\nvar CalendarUtils = tslib_1.__importStar(require(\"./CalendarUtils\"));\n\nvar Animation_1 = require(\"./Animation\");\n\nvar CDS = tslib_1.__importStar(require(\"./CalendarDateShape\"));\n\nvar MonthViewModel_1 = require(\"./MonthViewModel\");\n\nvar CalendarScrollEvents_1 = tslib_1.__importDefault(require(\"./CalendarScrollEvents\"));\n\nvar Month_1 = require(\"./Month\");\n\nvar Calendar_module_less_1 = tslib_1.__importDefault(require(\"./Calendar.module.css\"));\n\nvar Calendar_styles_1 = tslib_1.__importDefault(require(\"./Calendar.styles\"));\n\nvar Emotion_1 = require(\"../../lib/theming/Emotion\");\n\nvar ThemeConsumer_1 = tslib_1.__importDefault(require(\"../ThemeConsumer\"));\n\nvar getTodayDate = function getTodayDate() {\n  var date = new Date();\n  return {\n    date: date.getDate(),\n    month: date.getMonth(),\n    year: date.getFullYear()\n  };\n};\n\nvar wrapperStyle = {\n  height: config_1[\"default\"].WRAPPER_HEIGHT\n};\n\nvar Calendar =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(Calendar, _super);\n\n  function Calendar(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.animation = Animation_1.Animation();\n    /**\r\n                                                * Scrolls calendar to given date\r\n                                                * @public\r\n                                                */\n\n    _this.scrollToMonth = function (month, year) {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var _a, minDate, maxDate, currentMonth, diffInMonths, maxMonthsToAdd, onEnd, isYearChanges, monthsToPrependCount, monthsToPrepend_1, monthsToAppendCount_1, monthsToAppend_1;\n\n        var _this = this;\n\n        return tslib_1.__generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!this.animation.inProgress()) return [3\n              /*break*/\n              , 2];\n              this.animation.finish(); // FIXME: Dirty hack to await batched updates\n\n              return [4\n              /*yield*/\n              , new Promise(function (r) {\n                return setTimeout(r);\n              })];\n\n            case 1:\n              // FIXME: Dirty hack to await batched updates\n              _b.sent();\n\n              _b.label = 2;\n\n            case 2:\n              _a = this.props, minDate = _a.minDate, maxDate = _a.maxDate;\n\n              if (minDate && CDS.isGreater(minDate, CDS.create(32, month, year))) {\n                this.scrollToMonth(minDate.month, minDate.year);\n                return [2\n                /*return*/\n                ];\n              }\n\n              if (maxDate && CDS.isLess(maxDate, CDS.create(0, month, year))) {\n                this.scrollToMonth(maxDate.month, maxDate.year);\n                return [2\n                /*return*/\n                ];\n              }\n\n              currentMonth = this.state.months[1];\n              diffInMonths = currentMonth.month + currentMonth.year * 12 - month - year * 12;\n\n              if (diffInMonths === 0) {\n                this.scrollTo(0);\n                return [2\n                /*return*/\n                ];\n              }\n\n              maxMonthsToAdd = config_1[\"default\"].MAX_MONTHS_TO_APPEND_ON_SCROLL;\n\n              onEnd = function onEnd() {\n                return _this.setState({\n                  months: CalendarUtils.getMonths(month, year),\n                  scrollPosition: 0\n                });\n              };\n\n              isYearChanges = function isYearChanges(state) {\n                return state.months[1].year !== year && // if diff in months is 2 or less,\n                // either year is not changing either months already\n                // have right isFirstInYear/isLastInYear flags\n                Math.abs(diffInMonths) > 2;\n              }; // If scrolling upwards, prepend maximum maxMonthsToAdd months\n              // and scroll to the first month\n\n\n              if (diffInMonths > 0) {\n                monthsToPrependCount = Math.min(Math.abs(diffInMonths) - 1, maxMonthsToAdd);\n                monthsToPrepend_1 = Array.from({\n                  length: monthsToPrependCount\n                }, function (_, index) {\n                  return MonthViewModel_1.MonthViewModel.create(month + index, year);\n                });\n                this.setState(function (state) {\n                  var yearChanges = isYearChanges(state);\n\n                  if (yearChanges) {\n                    // Mutating here can lead to some unexpected bugs\n                    // but we couldn't find any yet\n                    state.months[0].isFirstInYear = true;\n\n                    if (monthsToPrepend_1.length) {\n                      // Mutating item here is safe as it was just created\n                      monthsToPrepend_1[monthsToPrepend_1.length - 1].isLastInYear = true;\n                    }\n                  }\n\n                  return {\n                    months: monthsToPrepend_1.concat(state.months),\n                    scrollPosition: -CalendarUtils.getMonthsHeight(monthsToPrepend_1)\n                  };\n                }, function () {\n                  var targetPosition = _this.state.months[0].height;\n\n                  _this.scrollTo(targetPosition, onEnd);\n                });\n              } // If scrolling downwards, append maximum maxMonthsToAdd months\n              // and scroll to the last but one month\n\n\n              if (diffInMonths < 0) {\n                monthsToAppendCount_1 = Math.min(Math.abs(diffInMonths), maxMonthsToAdd);\n                monthsToAppend_1 = Array.from({\n                  length: monthsToAppendCount_1\n                }, function (_, index) {\n                  return MonthViewModel_1.MonthViewModel.create(month + index - monthsToAppendCount_1 + 2, year);\n                });\n                this.setState(function (state) {\n                  if (isYearChanges(state)) {\n                    // Mutating here can lead to some unexpected bugs\n                    // but we couldn't find any yet\n                    state.months[state.months.length - 1].isLastInYear = true; // Mutating item here is safe as it was just created\n\n                    if (monthsToAppend_1[0]) {\n                      monthsToAppend_1[0].isFirstInYear = true;\n                    }\n                  }\n\n                  return {\n                    months: state.months.concat(monthsToAppend_1)\n                  };\n                }, function () {\n                  var targetPosition = -1 * CalendarUtils.getMonthsHeight(_this.state.months.slice(1, -2));\n\n                  _this.scrollTo(targetPosition, onEnd);\n                });\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.refRoot = function (element) {\n      if (!_this.root && element) {\n        element.addEventListener('wheel', _this.handleWheel, {\n          passive: false\n        });\n      }\n\n      if (_this.root && !element) {\n        _this.root.removeEventListener('wheel', _this.handleWheel);\n      }\n\n      _this.root = element;\n    };\n\n    _this.handleMonthYearChange = function (month, year) {\n      _this.scrollToMonth(month, year);\n    };\n\n    _this.handleWheel = function (event) {\n      if (!(event instanceof WheelEvent)) {\n        return;\n      }\n\n      event.preventDefault();\n      var pixelY = normalize_wheel_1[\"default\"](event).pixelY;\n\n      _this.setState(function (_a) {\n        var months = _a.months,\n            scrollPosition = _a.scrollPosition,\n            scrollTarget = _a.scrollTarget;\n        var targetPosition = CalendarUtils.calculateScrollPosition(months, scrollPosition, pixelY).scrollPosition;\n        return {\n          scrollTarget: targetPosition\n        };\n      }, _this.handleWheelEnd);\n\n      _this.animation.animate(pixelY, function (deltaY) {\n        // FIXME: Typescript not resolving setState cb type\n        return _this.setState(CalendarUtils.applyDelta(deltaY));\n      });\n\n      CalendarScrollEvents_1[\"default\"].emit();\n    };\n\n    _this.handleWheelEnd = function () {\n      if (_this.wheelEndTimeout) {\n        clearTimeout(_this.wheelEndTimeout);\n      }\n\n      _this.wheelEndTimeout = window.setTimeout(_this.scrollToNearestWeek, 300);\n    };\n\n    _this.scrollToNearestWeek = function () {\n      var _a = _this.state,\n          scrollTarget = _a.scrollTarget,\n          scrollDirection = _a.scrollDirection;\n      var trasholdHeight = config_1[\"default\"].MONTH_TITLE_OFFSET_HEIGHT + config_1[\"default\"].DAY_HEIGHT;\n\n      if (scrollTarget < trasholdHeight) {\n        var targetPosition_1 = 0;\n\n        if (scrollDirection < 0) {\n          targetPosition_1 = trasholdHeight;\n        }\n\n        _this.setState({\n          scrollTarget: targetPosition_1\n        }, function () {\n          var amount = scrollTarget - targetPosition_1;\n\n          _this.animation.animate(amount, function (deltaY) {\n            // FIXME: Typescript not resolving setState cb type\n            return _this.setState(CalendarUtils.applyDelta(deltaY));\n          });\n        });\n      }\n    };\n\n    _this.scrollTo = function (pos, onEnd) {\n      var scrollAmmount = pos - _this.state.scrollPosition;\n      return _this.scrollAmount(scrollAmmount, onEnd);\n    };\n\n    _this.scrollAmount = function (scrollAmmount, onEnd) {\n      return _this.animation.animate(scrollAmmount, function (deltaY) {\n        return _this.setState(function (_a) {\n          var scrollPosition = _a.scrollPosition;\n          return {\n            scrollPosition: scrollPosition + deltaY\n          };\n        });\n      }, onEnd);\n    };\n\n    var today = getTodayDate();\n    var initialMonth = props.initialMonth == null ? today.month : props.initialMonth;\n    var initialYear = props.initialYear == null ? today.year : props.initialYear;\n    _this.state = {\n      scrollPosition: 0,\n      months: CalendarUtils.getMonths(initialMonth, initialYear),\n      today: today,\n      scrollDirection: 1,\n      scrollTarget: 0\n    };\n    return _this;\n  }\n\n  Calendar.prototype.componentWillUnmount = function () {\n    if (this.animation.inProgress()) {\n      this.animation.cancel();\n    }\n  };\n\n  Calendar.prototype.render = function () {\n    var _this = this;\n\n    return React.createElement(ThemeConsumer_1[\"default\"], null, function (theme) {\n      _this.theme = theme;\n      return _this.renderMain();\n    });\n  };\n\n  Calendar.prototype.renderMain = function () {\n    var positions = this.getMonthPositions();\n    return React.createElement(\"div\", {\n      ref: this.refRoot,\n      className: Emotion_1.cx(Calendar_module_less_1[\"default\"].root, Calendar_styles_1[\"default\"].root(this.theme))\n    }, React.createElement(\"div\", {\n      style: wrapperStyle,\n      className: Calendar_module_less_1[\"default\"].wrapper\n    }, this.state.months.map(function (x, i) {\n      return [positions[i], x];\n    }).filter(function (_a) {\n      var top = _a[0],\n          month = _a[1];\n      return CalendarUtils.isMonthVisible(top, month);\n    }).map(this.renderMonth, this)));\n  };\n\n  Calendar.prototype.renderMonth = function (_a) {\n    var top = _a[0],\n        month = _a[1];\n    return React.createElement(Month_1.Month, {\n      key: month.month + '-' + month.year,\n      top: top,\n      month: month,\n      maxDate: this.props.maxDate,\n      minDate: this.props.minDate,\n      today: this.state.today,\n      value: this.props.value,\n      onDateClick: this.props.onSelect,\n      onMonthYearChange: this.handleMonthYearChange,\n      isHoliday: this.props.isHoliday\n    });\n  };\n\n  Calendar.prototype.getMonthPositions = function () {\n    var _a = this.state,\n        scrollPosition = _a.scrollPosition,\n        months = _a.months;\n    var positions = [scrollPosition - months[0].height];\n\n    for (var i = 1; i < months.length; i++) {\n      var position = positions[i - 1] + months[i - 1].height;\n      positions.push(position);\n    }\n\n    return positions;\n  };\n\n  Calendar.__KONTUR_REACT_UI__ = 'Calendar';\n  Calendar.defaultProps = {\n    holidays: [],\n    minDate: {\n      year: constants_1.MIN_YEAR,\n      month: constants_1.MIN_MONTH,\n      date: constants_1.MIN_DATE\n    },\n    maxDate: {\n      year: constants_1.MAX_YEAR,\n      month: constants_1.MAX_MONTH,\n      date: constants_1.MAX_DATE\n    }\n  };\n  return Calendar;\n}(React.Component);\n\nexports[\"default\"] = Calendar;","map":{"version":3,"sources":["/home/aleksandr/coursework.front/node_modules/@skbkontur/react-ui/components/Calendar/Calendar.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","React","__importStar","normalize_wheel_1","__importDefault","constants_1","config_1","CalendarUtils","Animation_1","CDS","MonthViewModel_1","CalendarScrollEvents_1","Month_1","Calendar_module_less_1","Calendar_styles_1","Emotion_1","ThemeConsumer_1","getTodayDate","date","Date","getDate","month","getMonth","year","getFullYear","wrapperStyle","height","WRAPPER_HEIGHT","Calendar","_super","__extends","props","_this","call","animation","Animation","scrollToMonth","__awaiter","_a","minDate","maxDate","currentMonth","diffInMonths","maxMonthsToAdd","onEnd","isYearChanges","monthsToPrependCount","monthsToPrepend_1","monthsToAppendCount_1","monthsToAppend_1","__generator","_b","label","inProgress","finish","Promise","r","setTimeout","sent","isGreater","create","isLess","state","months","scrollTo","MAX_MONTHS_TO_APPEND_ON_SCROLL","setState","getMonths","scrollPosition","Math","abs","min","Array","from","length","_","index","MonthViewModel","yearChanges","isFirstInYear","isLastInYear","concat","getMonthsHeight","targetPosition","slice","refRoot","element","root","addEventListener","handleWheel","passive","removeEventListener","handleMonthYearChange","event","WheelEvent","preventDefault","pixelY","scrollTarget","calculateScrollPosition","handleWheelEnd","animate","deltaY","applyDelta","emit","wheelEndTimeout","clearTimeout","window","scrollToNearestWeek","scrollDirection","trasholdHeight","MONTH_TITLE_OFFSET_HEIGHT","DAY_HEIGHT","targetPosition_1","amount","pos","scrollAmmount","scrollAmount","today","initialMonth","initialYear","prototype","componentWillUnmount","cancel","render","createElement","theme","renderMain","positions","getMonthPositions","ref","className","cx","style","wrapper","map","x","i","filter","top","isMonthVisible","renderMonth","Month","key","onDateClick","onSelect","onMonthYearChange","isHoliday","position","push","__KONTUR_REACT_UI__","defaultProps","holidays","MIN_YEAR","MIN_MONTH","MIN_DATE","MAX_YEAR","MAX_MONTH","MAX_DATE","Component"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar React = tslib_1.__importStar(require(\"react\"));\nvar normalize_wheel_1 = tslib_1.__importDefault(require(\"normalize-wheel\"));\nvar constants_1 = require(\"../../lib/date/constants\");\nvar config_1 = tslib_1.__importDefault(require(\"./config\"));\nvar CalendarUtils = tslib_1.__importStar(require(\"./CalendarUtils\"));\nvar Animation_1 = require(\"./Animation\");\nvar CDS = tslib_1.__importStar(require(\"./CalendarDateShape\"));\nvar MonthViewModel_1 = require(\"./MonthViewModel\");\nvar CalendarScrollEvents_1 = tslib_1.__importDefault(require(\"./CalendarScrollEvents\"));\nvar Month_1 = require(\"./Month\");\nvar Calendar_module_less_1 = tslib_1.__importDefault(require(\"./Calendar.module.css\"));\nvar Calendar_styles_1 = tslib_1.__importDefault(require(\"./Calendar.styles\"));\nvar Emotion_1 = require(\"../../lib/theming/Emotion\");\nvar ThemeConsumer_1 = tslib_1.__importDefault(require(\"../ThemeConsumer\"));\nvar getTodayDate = function getTodayDate() {\n  var date = new Date();\n  return {\n    date: date.getDate(),\n    month: date.getMonth(),\n    year: date.getFullYear() };\n\n};\nvar wrapperStyle = { height: config_1[\"default\"].WRAPPER_HEIGHT };\nvar Calendar = /** @class */function (_super) {\n  tslib_1.__extends(Calendar, _super);\n  function Calendar(props) {\n    var _this = _super.call(this, props) || this;\n    _this.animation = Animation_1.Animation();\n    /**\r\n                                                * Scrolls calendar to given date\r\n                                                * @public\r\n                                                */\n    _this.scrollToMonth = function (month, year) {return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var _a, minDate, maxDate, currentMonth, diffInMonths, maxMonthsToAdd, onEnd, isYearChanges, monthsToPrependCount, monthsToPrepend_1, monthsToAppendCount_1, monthsToAppend_1;\n        var _this = this;\n        return tslib_1.__generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!this.animation.inProgress()) return [3 /*break*/, 2];\n              this.animation.finish();\n              // FIXME: Dirty hack to await batched updates\n              return [4 /*yield*/, new Promise(function (r) {return setTimeout(r);})];\n            case 1:\n              // FIXME: Dirty hack to await batched updates\n              _b.sent();\n              _b.label = 2;\n            case 2:\n              _a = this.props, minDate = _a.minDate, maxDate = _a.maxDate;\n              if (minDate && CDS.isGreater(minDate, CDS.create(32, month, year))) {\n                this.scrollToMonth(minDate.month, minDate.year);\n                return [2 /*return*/];\n              }\n              if (maxDate && CDS.isLess(maxDate, CDS.create(0, month, year))) {\n                this.scrollToMonth(maxDate.month, maxDate.year);\n                return [2 /*return*/];\n              }\n              currentMonth = this.state.months[1];\n              diffInMonths = currentMonth.month + currentMonth.year * 12 - month - year * 12;\n              if (diffInMonths === 0) {\n                this.scrollTo(0);\n                return [2 /*return*/];\n              }\n              maxMonthsToAdd = config_1[\"default\"].MAX_MONTHS_TO_APPEND_ON_SCROLL;\n              onEnd = function onEnd() {\n                return _this.setState({\n                  months: CalendarUtils.getMonths(month, year),\n                  scrollPosition: 0 });\n\n              };\n              isYearChanges = function isYearChanges(state) {\n                return state.months[1].year !== year &&\n                // if diff in months is 2 or less,\n                // either year is not changing either months already\n                // have right isFirstInYear/isLastInYear flags\n                Math.abs(diffInMonths) > 2;\n              };\n              // If scrolling upwards, prepend maximum maxMonthsToAdd months\n              // and scroll to the first month\n              if (diffInMonths > 0) {\n                monthsToPrependCount = Math.min(Math.abs(diffInMonths) - 1, maxMonthsToAdd);\n                monthsToPrepend_1 = Array.from({ length: monthsToPrependCount }, function (_, index) {\n                  return MonthViewModel_1.MonthViewModel.create(month + index, year);\n                });\n                this.setState(function (state) {\n                  var yearChanges = isYearChanges(state);\n                  if (yearChanges) {\n                    // Mutating here can lead to some unexpected bugs\n                    // but we couldn't find any yet\n                    state.months[0].isFirstInYear = true;\n                    if (monthsToPrepend_1.length) {\n                      // Mutating item here is safe as it was just created\n                      monthsToPrepend_1[monthsToPrepend_1.length - 1].isLastInYear = true;\n                    }\n                  }\n                  return {\n                    months: monthsToPrepend_1.concat(state.months),\n                    scrollPosition: -CalendarUtils.getMonthsHeight(monthsToPrepend_1) };\n\n                }, function () {\n                  var targetPosition = _this.state.months[0].height;\n                  _this.scrollTo(targetPosition, onEnd);\n                });\n              }\n              // If scrolling downwards, append maximum maxMonthsToAdd months\n              // and scroll to the last but one month\n              if (diffInMonths < 0) {\n                monthsToAppendCount_1 = Math.min(Math.abs(diffInMonths), maxMonthsToAdd);\n                monthsToAppend_1 = Array.from({ length: monthsToAppendCount_1 }, function (_, index) {\n                  return MonthViewModel_1.MonthViewModel.create(month + index - monthsToAppendCount_1 + 2, year);\n                });\n                this.setState(function (state) {\n                  if (isYearChanges(state)) {\n                    // Mutating here can lead to some unexpected bugs\n                    // but we couldn't find any yet\n                    state.months[state.months.length - 1].isLastInYear = true;\n                    // Mutating item here is safe as it was just created\n                    if (monthsToAppend_1[0]) {\n                      monthsToAppend_1[0].isFirstInYear = true;\n                    }\n                  }\n                  return { months: state.months.concat(monthsToAppend_1) };\n                }, function () {\n                  var targetPosition = -1 * CalendarUtils.getMonthsHeight(_this.state.months.slice(1, -2));\n                  _this.scrollTo(targetPosition, onEnd);\n                });\n              }\n              return [2 /*return*/];}\n\n        });\n      });};\n    _this.refRoot = function (element) {\n      if (!_this.root && element) {\n        element.addEventListener('wheel', _this.handleWheel, { passive: false });\n      }\n      if (_this.root && !element) {\n        _this.root.removeEventListener('wheel', _this.handleWheel);\n      }\n      _this.root = element;\n    };\n    _this.handleMonthYearChange = function (month, year) {\n      _this.scrollToMonth(month, year);\n    };\n    _this.handleWheel = function (event) {\n      if (!(event instanceof WheelEvent)) {\n        return;\n      }\n      event.preventDefault();\n      var pixelY = normalize_wheel_1[\"default\"](event).pixelY;\n      _this.setState(function (_a) {\n        var months = _a.months,scrollPosition = _a.scrollPosition,scrollTarget = _a.scrollTarget;\n        var targetPosition = CalendarUtils.calculateScrollPosition(months, scrollPosition, pixelY).scrollPosition;\n        return { scrollTarget: targetPosition };\n      }, _this.handleWheelEnd);\n      _this.animation.animate(pixelY, function (deltaY) {\n        // FIXME: Typescript not resolving setState cb type\n        return _this.setState(CalendarUtils.applyDelta(deltaY));\n      });\n      CalendarScrollEvents_1[\"default\"].emit();\n    };\n    _this.handleWheelEnd = function () {\n      if (_this.wheelEndTimeout) {\n        clearTimeout(_this.wheelEndTimeout);\n      }\n      _this.wheelEndTimeout = window.setTimeout(_this.scrollToNearestWeek, 300);\n    };\n    _this.scrollToNearestWeek = function () {\n      var _a = _this.state,scrollTarget = _a.scrollTarget,scrollDirection = _a.scrollDirection;\n      var trasholdHeight = config_1[\"default\"].MONTH_TITLE_OFFSET_HEIGHT + config_1[\"default\"].DAY_HEIGHT;\n      if (scrollTarget < trasholdHeight) {\n        var targetPosition_1 = 0;\n        if (scrollDirection < 0) {\n          targetPosition_1 = trasholdHeight;\n        }\n        _this.setState({ scrollTarget: targetPosition_1 }, function () {\n          var amount = scrollTarget - targetPosition_1;\n          _this.animation.animate(amount, function (deltaY) {\n            // FIXME: Typescript not resolving setState cb type\n            return _this.setState(CalendarUtils.applyDelta(deltaY));\n          });\n        });\n      }\n    };\n    _this.scrollTo = function (pos, onEnd) {\n      var scrollAmmount = pos - _this.state.scrollPosition;\n      return _this.scrollAmount(scrollAmmount, onEnd);\n    };\n    _this.scrollAmount = function (scrollAmmount, onEnd) {\n      return _this.animation.animate(scrollAmmount, function (deltaY) {\n        return _this.setState(function (_a) {\n          var scrollPosition = _a.scrollPosition;\n          return {\n            scrollPosition: scrollPosition + deltaY };\n\n        });\n      }, onEnd);\n    };\n    var today = getTodayDate();\n    var initialMonth = props.initialMonth == null ? today.month : props.initialMonth;\n    var initialYear = props.initialYear == null ? today.year : props.initialYear;\n    _this.state = {\n      scrollPosition: 0,\n      months: CalendarUtils.getMonths(initialMonth, initialYear),\n      today: today,\n      scrollDirection: 1,\n      scrollTarget: 0 };\n\n    return _this;\n  }\n  Calendar.prototype.componentWillUnmount = function () {\n    if (this.animation.inProgress()) {\n      this.animation.cancel();\n    }\n  };\n  Calendar.prototype.render = function () {\n    var _this = this;\n    return React.createElement(ThemeConsumer_1[\"default\"], null, function (theme) {\n      _this.theme = theme;\n      return _this.renderMain();\n    });\n  };\n  Calendar.prototype.renderMain = function () {\n    var positions = this.getMonthPositions();\n    return React.createElement(\"div\", { ref: this.refRoot, className: Emotion_1.cx(Calendar_module_less_1[\"default\"].root, Calendar_styles_1[\"default\"].root(this.theme)) },\n    React.createElement(\"div\", { style: wrapperStyle, className: Calendar_module_less_1[\"default\"].wrapper }, this.state.months.\n    map(function (x, i) {return [positions[i], x];}).\n    filter(function (_a) {\n      var top = _a[0],month = _a[1];\n      return CalendarUtils.isMonthVisible(top, month);\n    }).\n    map(this.renderMonth, this)));\n  };\n  Calendar.prototype.renderMonth = function (_a) {\n    var top = _a[0],month = _a[1];\n    return React.createElement(Month_1.Month, { key: month.month + '-' + month.year, top: top, month: month, maxDate: this.props.maxDate, minDate: this.props.minDate, today: this.state.today, value: this.props.value, onDateClick: this.props.onSelect, onMonthYearChange: this.handleMonthYearChange, isHoliday: this.props.isHoliday });\n  };\n  Calendar.prototype.getMonthPositions = function () {\n    var _a = this.state,scrollPosition = _a.scrollPosition,months = _a.months;\n    var positions = [scrollPosition - months[0].height];\n    for (var i = 1; i < months.length; i++) {\n      var position = positions[i - 1] + months[i - 1].height;\n      positions.push(position);\n    }\n    return positions;\n  };\n  Calendar.__KONTUR_REACT_UI__ = 'Calendar';\n  Calendar.defaultProps = {\n    holidays: [],\n    minDate: {\n      year: constants_1.MIN_YEAR,\n      month: constants_1.MIN_MONTH,\n      date: constants_1.MIN_DATE },\n\n    maxDate: {\n      year: constants_1.MAX_YEAR,\n      month: constants_1.MAX_MONTH,\n      date: constants_1.MAX_DATE } };\n\n\n  return Calendar;\n}(React.Component);\nexports[\"default\"] = Calendar;"]},"metadata":{},"sourceType":"script"}