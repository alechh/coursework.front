"use strict";exports.__esModule = true;exports["default"] = void 0;
var React = _interopRequireWildcard(require("react"));
var _reactDom = require("react-dom");
var _propTypes = _interopRequireDefault(require("prop-types"));
var _classnames = _interopRequireDefault(require("classnames"));
var _Calendar = _interopRequireDefault(require("@skbkontur/react-icons/Calendar"));
var _filterProps = _interopRequireDefault(require("../filterProps"));
var _Picker = _interopRequireDefault(require("./Picker"));
var _DateInput = _interopRequireDefault(require("./DateInput"));
var _dateParser = _interopRequireDefault(require("./dateParser"));
var _DropdownContainer = _interopRequireDefault(require("../DropdownContainer/DropdownContainer"));
var _RenderLayer = _interopRequireDefault(require("../RenderLayer"));
var _Center = _interopRequireDefault(require("../Center"));
var _warning = _interopRequireDefault(require("warning"));var _DatePickerOldModule = _interopRequireDefault(require("./DatePickerOld.module.css"));

var _ensureOldIEClassName = require("../ensureOldIEClassName");function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { "default": obj };}function _getRequireWildcardCache() {if (typeof WeakMap !== "function") return null;var cache = new WeakMap();_getRequireWildcardCache = function _getRequireWildcardCache() {return cache;};return cache;}function _interopRequireWildcard(obj) {if (obj && obj.__esModule) {return obj;}if (obj === null || typeof obj !== "object" && typeof obj !== "function") {return { "default": obj };}var cache = _getRequireWildcardCache();if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj["default"] = obj;if (cache) {cache.set(obj, newObj);}return newObj;}function _extends() {_extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};return _extends.apply(this, arguments);}function _assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _inheritsLoose(subClass, superClass) {subClass.prototype = Object.create(superClass.prototype);subClass.prototype.constructor = subClass;subClass.__proto__ = superClass;}function _defineProperty(obj, key, value) {if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}

var INPUT_PASS_PROPS = {
  autoFocus: true,
  disabled: true,
  warning: true,
  error: true,
  withMask: true,
  placeholder: true,
  size: true,

  onInput: true,
  onKeyDown: true,
  onKeyPress: true,
  onKeyUp: true,

  onMouseEnter: true,
  onMouseLeave: true,
  onMouseOver: true };


/**
                        * @deprecated Компонент устарел и будет удален в версии 2.0.0. Используйте актульный [DatePicker](#/Components/DatePicker).
                        */var
DatePickerOld = /*#__PURE__*/function (_React$Component) {_inheritsLoose(DatePickerOld, _React$Component);








































































  function DatePickerOld(props, context) {var _this;
    _this = _React$Component.call(this, props, context) || this;_defineProperty(_assertThisInitialized(_this), "input", void 0);_defineProperty(_assertThisInitialized(_this), "_focusSubscription", void 0);_defineProperty(_assertThisInitialized(_this), "_focused", void 0);_defineProperty(_assertThisInitialized(_this), "getValue",


















































































    function () {
      var value = _this.props.value;
      if (value instanceof Date) {
        return formatDate(value);
      }
      if (typeof value === 'string') {
        return value;
      }
      return '';
    });_defineProperty(_assertThisInitialized(_this), "handleChange",

    function (value) {
      _this.setState({ textValue: value });
    });_defineProperty(_assertThisInitialized(_this), "handleFocus",

    function () {
      if (_this._focused) {
        return;
      }

      _this._focused = true;

      _this.setState({ opened: true });

      if (_this.props.onFocus) {
        _this.props.onFocus();
      }
    });_defineProperty(_assertThisInitialized(_this), "handleBlur",

    function () {
      if (!_this._focused) {
        return;
      }

      _this._focused = false;

      _this.close(false);

      _this._handleSubmit();

      if (_this.props.onBlur) {
        _this.props.onBlur();
      }
      _this.input.blur();
    });_defineProperty(_assertThisInitialized(_this), "_handleSubmit",

    function () {
      var value = _this.state.textValue;
      var date = parseDate(value);
      var newDate = date === null ? getDateValue(value, _this.props.onUnexpectedInput) : date;

      var textValue = typeof newDate === 'string' ? newDate : formatDate(newDate);

      _this.setState({ textValue: textValue });

      if (_this.props.onChange) {
        _this.props.onChange({ target: { value: newDate } }, newDate);
      }
    });_defineProperty(_assertThisInitialized(_this), "handlePick",

    function (date) {
      if (_this.props.onChange) {
        _this.props.onChange({ target: { value: date } }, date);
      }
      _this._focused = false;
      _this.close(false);
      if (_this.props.onBlur) {
        _this.props.onBlur();
      }
      if (_ensureOldIEClassName.isIE) {
        // NOTE In IE can't blur input with mask https://github.com/sanniassin/react-input-mask/issues/73
        setTimeout(function () {return _this.input.blur();});
      } else {
        _this.input.blur();
      }
    });_defineProperty(_assertThisInitialized(_this), "handlePickerClose",

    function () {
      _this.close(false);
    });_defineProperty(_assertThisInitialized(_this), "getInputRef",









    function (ref) {
      _this.input = ref;
    });var _textValue = typeof props.value === 'string' ? props.value : formatDate(props.value);_this.state = { opened: false, textValue: _textValue };(0, _warning["default"])(false, 'DatePickerOld is deprecated and will be removed in v2.0.0. Please, use the actual DatePicker instead.');return _this;} /**
                                                                                                                                                                                                                                                                                                                * @public
                                                                                                                                                                                                                                                                                                                */var _proto = DatePickerOld.prototype;_proto.blur = function blur() {this.handleBlur();} /**
                                                                                                                                                                                                                                                                                                                                                                                                           * @public
                                                                                                                                                                                                                                                                                                                                                                                                           */;_proto.focus = function focus() {this.input.selectAll();this.handleFocus();};_proto.render = function render() {var _this2 = this,_classNames,_classNames2;var opened = this.state.opened;var _this$props = this.props,value = _this$props.value,menuAlign = _this$props.menuAlign,width = _this$props.width;var date = isDate(value) ? value : null;var picker = null;if (opened) {picker = React.createElement(_DropdownContainer["default"], { getParent: function getParent() {return (0, _reactDom.findDOMNode)(_this2);}, offsetY: 2, align: menuAlign }, React.createElement(_Picker["default"], { value: date, minYear: this.props.minYear, maxYear: this.props.maxYear, onPick: this.handlePick }));}var className = (0, _classnames["default"])((_classNames = {}, _classNames[_DatePickerOldModule["default"].root] = true, _classNames[this.props.className || ''] = true, _classNames));var iconSize = this.props.size === 'large' ? 16 : 14;var openClassName = (0, _classnames["default"])((_classNames2 = {}, _classNames2[_DatePickerOldModule["default"].openButton] = true, _classNames2[_DatePickerOldModule["default"].openButtonDisabled] = this.props.disabled, _classNames2));return React.createElement(_RenderLayer["default"], { active: opened }, React.createElement("label", { className: className, style: { width: width } }, React.createElement(_DateInput["default"], _extends({}, (0, _filterProps["default"])(this.props, INPUT_PASS_PROPS), { getInputRef: this.getInputRef, opened: opened, value: this.state.textValue, onFocus: this.handleFocus, onChange: this.handleChange, onSubmit: this._handleSubmit, onBlur: this.handleBlur })), picker, React.createElement(_Center["default"], { className: openClassName, onMouseDown: function onMouseDown(e) {return e.preventDefault();} }, React.createElement(_Calendar["default"], { size: iconSize }))));};_proto.componentWillReceiveProps = function componentWillReceiveProps(_ref) {var newValue = _ref.value;var oldValue = this.props.value;if (newValue && +newValue !== +oldValue) {var textValue = typeof newValue === 'string' ? newValue : formatDate(newValue);this.setState({ textValue: textValue });}};_proto.close = function close(focus) {var _this3 = this;this.setState({ opened: false }, function () {if (focus) {_this3.input.focus();}});};return DatePickerOld;}(React.Component);_defineProperty(DatePickerOld, "__KONTUR_REACT_UI__", 'DatePickerOld');_defineProperty(DatePickerOld, "__REACT_UI_COMPONENT_NAME__", 'DatePicker');_defineProperty(DatePickerOld, "propTypes", { disabled: _propTypes["default"].bool, error: _propTypes["default"].bool, /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Максимальный год в селекте для года.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */maxYear: _propTypes["default"].number, menuAlign: _propTypes["default"].oneOf(['left', 'right']), /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Минимальный год в селекте для года.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */minYear: _propTypes["default"].number, value: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].instanceOf(Date)]), warning: _propTypes["default"].bool, width: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]), /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Маска ввода 99.99.9999
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */withMask: _propTypes["default"].bool, onBlur: _propTypes["default"].func, onChange: _propTypes["default"].func, onFocus: _propTypes["default"].func, onInput: _propTypes["default"].func, onKeyDown: _propTypes["default"].func, onKeyPress: _propTypes["default"].func, onKeyUp: _propTypes["default"].func, onMouseEnter: _propTypes["default"].func, onMouseLeave: _propTypes["default"].func, onMouseOver: _propTypes["default"].func, /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * Если не получилось распарсить дату,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * можно получить содержимое инпута
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * (например, для валидации снаружи)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        */onUnexpectedInput: _propTypes["default"].func });_defineProperty(DatePickerOld, "defaultProps", { minYear: 1900, maxYear: 2100, width: 120, withMask: true, onUnexpectedInput: function onUnexpectedInput() {return null;} });var getDateValue = function getDateValue(value, onUnexpectedInput) {if (value == null) {return null;}if (value instanceof Date) {return value;}var newDate = parseDate(value, false);if (newDate) {return newDate;}if (onUnexpectedInput) {
    return onUnexpectedInput(value);
  }
  return null;
};

function isDate(date) /* : boolean %checks */{
  return date instanceof Date && !isNaN(date.getTime());
}

function formatDate(date) {
  if (!date || !isDate(date)) {
    return '';
  }

  var day = date.
  getUTCDate().
  toString().
  padStart(2, '0');
  var month = (date.getUTCMonth() + 1).toString().padStart(2, '0');
  return day + "." + month + "." + date.getUTCFullYear();
}

function parseDate(str, withCorrection) {
  var date = (0, _dateParser["default"])(str, withCorrection);
  return isDate(date) ? date : null;
}var _default =

DatePickerOld;exports["default"] = _default;