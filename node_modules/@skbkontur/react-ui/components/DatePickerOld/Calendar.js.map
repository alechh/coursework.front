{"version":3,"sources":["Calendar.js"],"names":["MONTH_NAMES","DAY","WEEK","FIRST_WEEK_SHIFT","Date","getUTCDay","DAY_HEIGHT","CALENDAR_HEIGHT","Calendar","props","context","element","root","addEventListener","handleWheel","passive","removeEventListener","event","preventDefault","deltaY","deltaMode","pos","state","setState","date","posToDate","setUTCDate","getUTCDate","onNav","dateToPos","initialDate","render","offset","from","week","getWeek","months","monthStart","i","monthEnd","getTime","setUTCMonth","getUTCMonth","y","getDayTop","height","style","top","monthClass","styles","month","first","grey","Math","max","wrapperStyle","position","display","opacity","transition","push","year","getUTCFullYear","cells","cellCount","ceil","cur","curWeek","cellProps","weekIdx","value","onPick","refRoot","moveToDate","newDate","setUTCFullYear","React","Component","floor","time","fromWeek"],"mappings":"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","sourcesContent":["// @flow\r\n\r\nimport classNames from 'classnames';\r\nimport * as React from 'react';\r\n\r\nimport styles from './Calendar.module.less';\r\n\r\nimport Cell from './CalendarCell';\r\n\r\nconst MONTH_NAMES = [\r\n  'Январь',\r\n  'Февраль',\r\n  'Март',\r\n  'Апрель',\r\n  'Май',\r\n  'Июнь',\r\n  'Июль',\r\n  'Август',\r\n  'Сентябрь',\r\n  'Октябрь',\r\n  'Ноябрь',\r\n  'Декабрь',\r\n];\r\nconst DAY = 24 * 60 * 60 * 1000;\r\nconst WEEK = 7 * DAY;\r\nconst FIRST_WEEK_SHIFT = (new Date(0).getUTCDay() - 1) * DAY;\r\nconst DAY_HEIGHT = 31;\r\nconst CALENDAR_HEIGHT = 220;\r\n\r\ntype Props = {\r\n  initialDate: Date,\r\n  value: ?Date,\r\n  onNav: (date: Date) => void,\r\n  onPick: (date: Date) => void,\r\n};\r\n\r\ntype State = {\r\n  pos: number,\r\n};\r\n\r\nexport default class Calendar extends React.Component<Props, State> {\r\n  static __KONTUR_REACT_UI__ = 'CalendarOld';\r\n\r\n  constructor(props: Props, context: mixed) {\r\n    super(props, context);\r\n\r\n    this.state = {\r\n      pos: dateToPos(props.initialDate),\r\n    };\r\n  }\r\n\r\n  render() {\r\n    let offset = this.state.pos % DAY_HEIGHT;\r\n    if (offset < 0) {\r\n      offset += DAY_HEIGHT;\r\n    }\r\n    const from = ((this.state.pos - offset) / DAY_HEIGHT) * WEEK - FIRST_WEEK_SHIFT;\r\n    const week = getWeek(from);\r\n\r\n    const months = [];\r\n    let monthStart = new Date(from);\r\n    monthStart.setUTCDate(1);\r\n    for (let i = 0; i < 4; ++i) {\r\n      const monthEnd = new Date(monthStart.getTime());\r\n      monthEnd.setUTCMonth(monthEnd.getUTCMonth() + 1);\r\n      const y = getDayTop(week, offset, +monthStart);\r\n      const height = getDayTop(week, offset, +monthEnd) - y;\r\n      const style = {\r\n        top: y,\r\n        height,\r\n      };\r\n      const monthClass = classNames({\r\n        [styles.month]: true,\r\n        [styles.first]: monthStart.getUTCMonth() === 0,\r\n        [styles.grey]: monthStart.getUTCMonth() % 2,\r\n      });\r\n      const top = Math.max(0, -y);\r\n      const wrapperStyle = {\r\n        position: 'relative',\r\n        top,\r\n        display: top > height ? 'none' : 'block',\r\n        opacity: top > height / 3 ? 0 : 1,\r\n        transition: 'opacity 0.2s ease-out',\r\n      };\r\n      months.push(\r\n        <div key={+monthStart} className={monthClass} style={style}>\r\n          <div style={wrapperStyle}>\r\n            {MONTH_NAMES[monthStart.getUTCMonth()]}\r\n            <div className={styles.year}>{monthStart.getUTCFullYear()}</div>\r\n          </div>\r\n        </div>,\r\n      );\r\n\r\n      monthStart = monthEnd;\r\n    }\r\n\r\n    const cells = [];\r\n    const cellCount = Math.ceil((CALENDAR_HEIGHT + offset) / DAY_HEIGHT) * 7;\r\n    for (let i = 0; i < cellCount; ++i) {\r\n      const cur = from + i * DAY;\r\n      const curWeek = getWeek(cur);\r\n      const date = new Date(cur);\r\n\r\n      const cellProps = {\r\n        date,\r\n        weekIdx: curWeek - week,\r\n        offset,\r\n        value: this.props.value,\r\n      };\r\n      cells.push(<Cell key={cur} {...cellProps} onPick={this.props.onPick} />);\r\n    }\r\n\r\n    return (\r\n      <div ref={this.refRoot} className={styles.root} tabIndex=\"0\">\r\n        {cells}\r\n        {months}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  refRoot = element => {\r\n    if (!this.root && element) {\r\n      element.addEventListener('wheel', this.handleWheel, { passive: false });\r\n    }\r\n    if (this.root && !element) {\r\n      this.root.removeEventListener('wheel', this.handleWheel);\r\n    }\r\n    this.root = element;\r\n  };\r\n\r\n  moveToDate(date: Date) {\r\n    const newDate = new Date(0);\r\n    newDate.setUTCFullYear(date.getUTCFullYear());\r\n    newDate.setUTCMonth(date.getUTCMonth());\r\n    this.setState({ pos: dateToPos(newDate) });\r\n  }\r\n\r\n  handleWheel = (event: SyntheticWheelEvent<>) => {\r\n    event.preventDefault();\r\n    let deltaY = event.deltaY;\r\n    if (event.deltaMode === 1) {\r\n      deltaY *= DAY_HEIGHT;\r\n    } else if (event.deltaMode === 2) {\r\n      deltaY *= DAY_HEIGHT * 4;\r\n    }\r\n\r\n    const pos = this.state.pos + deltaY;\r\n    this.setState({ pos });\r\n\r\n    const date = posToDate(pos);\r\n    date.setUTCDate(date.getUTCDate() + 6);\r\n    this.props.onNav(date);\r\n  };\r\n}\r\n\r\nfunction dateToPos(date) {\r\n  return (Math.floor((+date - FIRST_WEEK_SHIFT - DAY) / WEEK) - 1) * DAY_HEIGHT;\r\n}\r\n\r\nfunction posToDate(pos) {\r\n  return new Date(Math.floor(pos / DAY_HEIGHT + 2) * WEEK - FIRST_WEEK_SHIFT);\r\n}\r\n\r\nfunction getWeek(time) {\r\n  return Math.floor((FIRST_WEEK_SHIFT + time) / WEEK);\r\n}\r\n\r\nfunction getDayTop(fromWeek, offset, time) {\r\n  return (getWeek(time) - fromWeek) * DAY_HEIGHT - offset;\r\n}\r\n"]}