{"version":3,"sources":["AddressModal.js"],"names":["PLACES","AddressModal","props","onChange","address","state","onClose","invalidField","_regionProps","createFieldProps","_districtProps","_cityProps","_settlementProps","_streetProps","_houseProps","createSimpleFieldProps","_buildingProps","_roomProps","field","parents","level","source","createSource","createHandler","renderItem","_renderItem","bind","renderValue","valueToString","recover","event","value","setState","place","e","info","item","itemPlace","name","check","promise","_verifyPromise","then","result","isKladrAddress","invalidItem","searchText","parentCode","parentName","parent","code","values","map","infos","setStateAddress","key","render","title","_renderForm","_handleSave","styles","row","label","index","target","region","district","city","settlement","street","house","building","room","parentNames","i","length","parentField","substr","unshift","util","placeName","menuItemParents","join","React","Component","type"],"mappings":"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","sourcesContent":["// @flow\r\n/* eslint-disable flowtype/no-weak-types */\r\nimport * as React from 'react';\r\n\r\nimport Button from '../Button';\r\nimport ComboBox from '../ComboBoxOld';\r\nimport Gapped from '../Gapped';\r\nimport Input from '../Input';\r\nimport Modal from '../Modal';\r\n\r\nimport { search, verify } from './KladrAPI';\r\nimport type { Address, Place, PlaceDescription, VerifyResult } from './Types';\r\nimport * as util from './util';\r\n\r\nimport styles from './AddressModal.module.less';\r\n\r\ntype Props = {\r\n  address: Address,\r\n  title: string,\r\n  onChange: (value: { address: Address }) => void,\r\n  onClose: () => void,\r\n};\r\n\r\ntype State = {\r\n  address: Address,\r\n  invalidField: ?string,\r\n};\r\n\r\ntype Info = {\r\n  searchText: string,\r\n  address: Address,\r\n};\r\ntype SourceResult = {\r\n  values: Array<PlaceDescription>,\r\n  infos: Array<Info>,\r\n};\r\ntype SourceFunction = (searchText: string) => Promise<SourceResult>;\r\ntype HandlerFunction = (e: any, value: PlaceDescription, info?: Info) => void;\r\ntype FieldProps = {\r\n  source: SourceFunction,\r\n  onChange: HandlerFunction,\r\n  renderItem: Function,\r\n  renderValue: Function,\r\n  valueToString: (value: PlaceDescription) => string,\r\n  recover: Function,\r\n};\r\ntype SimpleFieldProps = {\r\n  onChange: (event: mixed, value: string) => void,\r\n};\r\n\r\nconst PLACES = {\r\n  '0': 'index',\r\n  '1': 'region',\r\n  '2': 'district',\r\n  '4': 'city',\r\n  '8': 'settlement',\r\n  '16': 'street',\r\n};\r\n\r\nexport default class AddressModal extends React.Component<Props, State> {\r\n  _regionProps: FieldProps;\r\n  _districtProps: FieldProps;\r\n  _cityProps: FieldProps;\r\n  _settlementProps: FieldProps;\r\n  _streetProps: FieldProps;\r\n  _houseProps: SimpleFieldProps;\r\n  _buildingProps: SimpleFieldProps;\r\n  _roomProps: SimpleFieldProps;\r\n\r\n  _verifyPromise: ?Promise<VerifyResult>;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      address: props.address || {},\r\n      invalidField: null,\r\n    };\r\n\r\n    this._regionProps = this.createFieldProps('region', [], 'Region');\r\n    this._districtProps = this.createFieldProps('district', ['region'], 'District');\r\n    this._cityProps = this.createFieldProps('city', ['region', 'district'], 'City');\r\n    this._settlementProps = this.createFieldProps('settlement', ['region', 'district', 'city'], 'Settlement');\r\n    this._streetProps = this.createFieldProps('street', ['region', 'district', 'city', 'settlement'], 'Street');\r\n    this._houseProps = this.createSimpleFieldProps('house');\r\n    this._buildingProps = this.createSimpleFieldProps('building');\r\n    this._roomProps = this.createSimpleFieldProps('room');\r\n  }\r\n\r\n  createFieldProps(field: Place, parents: Array<Place>, level: string): FieldProps {\r\n    return {\r\n      source: this.createSource(field, parents, level),\r\n      onChange: this.createHandler(field),\r\n      renderItem: this._renderItem.bind(this, field, parents),\r\n      renderValue: renderValue.bind(null, field),\r\n      valueToString: renderValue.bind(null, field),\r\n      recover,\r\n    };\r\n  }\r\n\r\n  createSimpleFieldProps(field: 'house' | 'room' | 'building'): SimpleFieldProps {\r\n    return {\r\n      onChange: (event, value) => {\r\n        const address: $Shape<Address> = {\r\n          ...this.state.address,\r\n          [field]: value,\r\n        };\r\n        this.setState({ address });\r\n      },\r\n    };\r\n  }\r\n\r\n  createHandler(place: string): HandlerFunction {\r\n    return (e, value, info) => {\r\n      const address = { ...this.state.address };\r\n      if (info) {\r\n        for (const item in PLACES) {\r\n          const itemPlace = PLACES[item];\r\n          if (itemPlace !== place && info.address[itemPlace]) {\r\n            address[itemPlace] = info.address[itemPlace];\r\n          } else if (itemPlace === place) {\r\n            address[place] = value;\r\n            break;\r\n          }\r\n        }\r\n      } else if (value.name) {\r\n        address[place] = value;\r\n      } else {\r\n        address[place] = null;\r\n      }\r\n\r\n      this.setState({ address });\r\n      this.check(address);\r\n    };\r\n  }\r\n\r\n  check(address: Address) {\r\n    const promise = verify(address);\r\n    this._verifyPromise = promise;\r\n\r\n    promise.then(result => {\r\n      if (promise !== this._verifyPromise) {\r\n        return;\r\n      }\r\n      this._verifyPromise = null;\r\n\r\n      let invalidField = null;\r\n      if (!result.isKladrAddress) {\r\n        invalidField = PLACES[result.invalidItem];\r\n      }\r\n      this.setState({\r\n        address: {\r\n          ...this.state.address, // Saving the `building` field.\r\n          ...result.address,\r\n        },\r\n        invalidField,\r\n      });\r\n    });\r\n  }\r\n\r\n  createSource(field: string, parents: Array<Place>, level: string) {\r\n    return (searchText: string) => {\r\n      let parentCode = null;\r\n      for (const parentName of parents) {\r\n        const parent = this.state.address[parentName];\r\n        if (parent && typeof parent === 'object' && parent.code) {\r\n          parentCode = parent.code;\r\n        }\r\n      }\r\n\r\n      return search(searchText, `[${level}]`, parentCode).then(values => ({\r\n        values: values.map(address => address[field]),\r\n        infos: values.map(address => ({ searchText, address })),\r\n      }));\r\n    };\r\n  }\r\n\r\n  setStateAddress(key: string, value: PlaceDescription | string) {\r\n    this.setState({\r\n      address: {\r\n        ...this.state.address,\r\n        [key]: value,\r\n      },\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal width={520} onClose={this.props.onClose}>\r\n        <Modal.Header>{this.props.title}</Modal.Header>\r\n        <Modal.Body>{this._renderForm()}</Modal.Body>\r\n        <Modal.Footer panel>\r\n          <Gapped>\r\n            <Button size=\"medium\" use=\"primary\" onClick={this._handleSave}>\r\n              Сохранить\r\n            </Button>\r\n            <Button size=\"medium\" onClick={this.props.onClose}>\r\n              Отмена\r\n            </Button>\r\n          </Gapped>\r\n        </Modal.Footer>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  _renderForm() {\r\n    const { invalidField } = this.state;\r\n\r\n    return (\r\n      <Gapped vertical>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Индекс</div>\r\n          <div className={styles.field}>\r\n            <Input\r\n              value={this.state.address.index}\r\n              width=\"100%\"\r\n              onChange={e => {\r\n                this.setStateAddress('index', e.target.value);\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Регион</div>\r\n          <div className={styles.field}>\r\n            <ComboBox\r\n              value={this.state.address.region}\r\n              error={invalidField === 'region'}\r\n              placeholder=\"Можно вводить код или название\"\r\n              width=\"100%\"\r\n              {...this._regionProps}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Район</div>\r\n          <div className={styles.field}>\r\n            <ComboBox\r\n              value={this.state.address.district}\r\n              error={invalidField === 'district'}\r\n              width=\"100%\"\r\n              {...this._districtProps}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Город</div>\r\n          <div className={styles.field}>\r\n            <ComboBox\r\n              value={this.state.address.city}\r\n              error={invalidField === 'city'}\r\n              width=\"100%\"\r\n              {...this._cityProps}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Населенный пункт</div>\r\n          <div className={styles.field}>\r\n            <ComboBox\r\n              value={this.state.address.settlement}\r\n              error={invalidField === 'settlement'}\r\n              width=\"100%\"\r\n              {...this._settlementProps}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Улица</div>\r\n          <div className={styles.field}>\r\n            <ComboBox\r\n              value={this.state.address.street}\r\n              error={invalidField === 'street'}\r\n              width=\"100%\"\r\n              {...this._streetProps}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Дом</div>\r\n          <div className={styles.field}>\r\n            <Input value={this.state.address.house} width={100} {...this._houseProps} />\r\n          </div>\r\n        </div>\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Корпус</div>\r\n          <div className={styles.field}>\r\n            <Input value={this.state.address.building || ''} width={100} {...this._buildingProps} />\r\n          </div>\r\n        </div>\r\n\r\n        <div className={styles.row}>\r\n          <div className={styles.label}>Квартира / офис</div>\r\n          <div className={styles.field}>\r\n            <Input value={this.state.address.room} width=\"100px\" {...this._roomProps} />\r\n          </div>\r\n        </div>\r\n      </Gapped>\r\n    );\r\n  }\r\n\r\n  _renderItem(field: Place, parents: Array<Place>, place: PlaceDescription, info: Info) {\r\n    const parentNames = [];\r\n    for (let i = parents.length - 1; i >= 0; --i) {\r\n      const parentField = parents[i];\r\n      if (this.state.address[parentField]) {\r\n        break;\r\n      }\r\n\r\n      const parent = info.address[parentField];\r\n      if (parent && typeof parent === 'object') {\r\n        let parentName = parent.name;\r\n        if (parentField === 'region') {\r\n          parentName = parent.code.substr(0, 2) + ' ' + parentName;\r\n        }\r\n        parentNames.unshift(parentName);\r\n      }\r\n    }\r\n    return (\r\n      <div>\r\n        {util.placeName(place, field)}\r\n        {parentNames.length > 0 && <div className={styles.menuItemParents}>{parentNames.join(', ')}</div>}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  _handleSave = () => {\r\n    this.props.onChange({ address: this.state.address });\r\n    this.props.onClose();\r\n  };\r\n}\r\n\r\nfunction renderValue(type: Place, place: ?PlaceDescription) {\r\n  return place ? util.placeName(place, type) : 'null';\r\n}\r\n\r\nfunction recover(searchText) {\r\n  return {\r\n    value: { name: searchText },\r\n  };\r\n}\r\n"]}